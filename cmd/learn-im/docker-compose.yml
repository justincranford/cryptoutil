# Learn-IM Docker Compose Configuration
#
# Provides learn-im service for development and testing.
# Includes health checks, networking, follows cryptoutil patterns.
#
# Usage:
#   docker compose up -d              # Start service
#   docker compose ps                 # Check status
#   docker compose logs -f learn-im   # View logs
#   docker compose down               # Stop and remove
#
# Services:
#   - learn-im: https://localhost:8888 (public),
#               https://localhost:9090 (admin)

services:
  learn-im:
    build:
      context: ../..
      dockerfile: cmd/learn-im/Dockerfile
      args:
        GO_VERSION: 1.25.5
        ALPINE_VERSION: 3.19
    image: learn-im:local
    container_name: learn-im
    ports:
      - "8888:8888"  # Public HTTPS API
      - "9090:9090"  # Admin HTTPS API (health checks)
    networks:
      - learn-im-network
    healthcheck:
      test: ["CMD", "wget", "--no-check-certificate", "--quiet",
             "--tries=1", "--spider",
             "https://127.0.0.1:9090/admin/v1/livez"]
      interval: 10s
      timeout: 5s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    # Command line args for configuration
    # Default: uses in-memory SQLite, binds to 127.0.0.1
    # command: ["--dev"]  # Already default
    labels:
      com.cryptoutil.service: "learn-im"
      com.cryptoutil.environment: "development"

networks:
  learn-im-network:
    driver: bridge
    name: learn-im-network
