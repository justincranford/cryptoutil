# $schema: https://json.schemastore.org/golangci-lint.json
# schema: https://golangci-lint.run/jsonschema/golangci.jsonschema.json
# doc: https://golangci-lint.run/docs/configuration/file/
# reference: https://github.com/golangci/golangci-lint/blob/HEAD/.golangci.reference.yml
# github repo: https://github.com/golangci/golangci-lint/tree/main
#
# golangci-lint configuration for cryptoutil project
# This project uses Go 1.25.4 with golangci-lint v2.6.2
#
# Usage: golangci-lint run --timeout=10m

version: "2"

run:
  timeout: 10m
  issues-exit-code: 1
  tests: true
  concurrency: 0  # Use all available CPUs

output:
  formats:
    tab:
      path: stdout
  sort-order:
    - linter
    - severity
    - file

linters:
  enable:
    # Essential linters (fast static analysis)
    - errcheck      # Check for unchecked errors
    - govet         # Reports suspicious constructs (Go's built-in vet)
    - ineffassign   # Detect ineffectual assignments
    - staticcheck   # Advanced static analysis (includes gosimple, stylecheck in v2)
    - unused        # Find unused constants, variables, functions and types

    # Code quality linters (fast)
    - revive        # Golint replacement with more rules
    - godot         # Check for missing periods in documentation comments
    - copyloopvar   # Check for loop variables captured by reference
    - goconst       # Find repeated strings that could be constants
    - importas      # Enforce consistent import aliasing

    # Security and error handling
    - gosec         # Security-focused static analysis
    - noctx         # Check for missing context in HTTP requests
    - wrapcheck     # Check error wrapping consistency
    - errorlint     # Find code that will cause problems with Go 1.13 error wrapping

    # Testing quality
    - thelper       # Check test helper functions
    - tparallel     # Check for parallel test issues
    - testpackage   # Test package naming conventions
    - gomodguard    # Prevent importing blocked modules
    - gomoddirectives # Validate Go module directives

    # Performance and style
    - prealloc      # Find slice declarations that could pre-allocate
    - bodyclose     # Check for HTTP response body closure
    - mnd           # Detect magic numbers
    - wsl           # Whitespace linter
    - nlreturn      # Enforce newlines after return statements

    # Maintainability
    - goheader      # Copyright header enforcement
    - depguard      # Enforce allowed/disallowed import dependencies

  disable:
    - dupl          # Code duplication
    - gocyclo       # Cyclomatic complexity
    - godox         # TODO/FIXME comments

  settings:
    errcheck:
      check-type-assertions: true
      check-blank: true

    gosec:
      severity: medium
      confidence: medium
      excludes:
        - G204  # Subprocess launched with variable
        - G301  # Directory permissions too permissive
        - G302  # File permissions too permissive
        - G304  # Potential file inclusion via variable
        - G402  # TLS InsecureSkipVerify set true

    gocyclo:
      min-complexity: 15

    goconst:
      min-len: 1
      min-occurrences: 2
      numbers: true

    mnd:
      ignored-numbers:
        - '2'  # Common in bit operations
      ignored-functions:
        - 'math.*'
        - 'len'
        - 'make'

    dupl:
      threshold: 100

    misspell:
      locale: US

    revive:
      severity: warning

    godot:
      scope: declarations
      capital: false

    godox:
      keywords:
        - TODO
        - FIXME
        - BUG
        - HACK

    thelper:
      test:
        begin: true

    testpackage:
      skip-regexp: '.*_test\.go$'

    importas:
      alias:
        # JOSE libraries
        - pkg: github.com/lestrrat-go/jwx/v3/jwe
          alias: joseJwe
        - pkg: github.com/lestrrat-go/jwx/v3/jwk
          alias: joseJwk
        - pkg: github.com/lestrrat-go/jwx/v3/jws
          alias: joseJws
        - pkg: github.com/lestrrat-go/jwx/v3/jwa
          alias: joseJwa
        # Google UUID
        - pkg: github.com/google/uuid
          alias: googleUuid
        # Standard library
        - pkg: encoding/json
          alias: json
        - pkg: encoding/xml
          alias: xml
        - pkg: net/http
          alias: http
        # Third-party
        - pkg: github.com/gofiber/fiber/v2
          alias: fiber
        - pkg: github.com/stretchr/testify
          alias: testify
        # Cryptoutil API packages
        - pkg: cryptoutil/api/client
          alias: cryptoutilOpenapiClient
        - pkg: cryptoutil/api/model
          alias: cryptoutilOpenapiModel
        - pkg: cryptoutil/api/server
          alias: cryptoutilOpenapiServer
        # Cryptoutil internal - client/command
        - pkg: cryptoutil/internal/client
          alias: cryptoutilClient
        - pkg: cryptoutil/internal/cmd
          alias: cryptoutilCmd
        - pkg: cryptoutil/internal/cmd/cryptoutil
          alias: cryptoutilCmdCryptoutil
        - pkg: cryptoutil/internal/cmd/workflow
          alias: cryptoutilWorkflow
        # Cryptoutil internal - test
        - pkg: cryptoutil/internal/test/e2e
          alias: cryptoutilE2E
        # Cryptoutil internal - common
        - pkg: cryptoutil/internal/common/apperr
          alias: cryptoutilAppErr
        - pkg: cryptoutil/internal/common/config
          alias: cryptoutilConfig
        - pkg: cryptoutil/internal/common/container
          alias: cryptoutilContainer
        - pkg: cryptoutil/internal/common/magic
          alias: cryptoutilMagic
        - pkg: cryptoutil/internal/common/pool
          alias: cryptoutilPool
        - pkg: cryptoutil/internal/common/telemetry
          alias: cryptoutilTelemetry
        - pkg: cryptoutil/internal/common/util
          alias: cryptoutilUtil
        - pkg: cryptoutil/internal/common/util/combinations
          alias: cryptoutilCombinations
        - pkg: cryptoutil/internal/common/util/datetime
          alias: cryptoutilDateTime
        - pkg: cryptoutil/internal/common/util/network
          alias: cryptoutilNetwork
        - pkg: cryptoutil/internal/common/util/sysinfo
          alias: cryptoutilSysinfo
        # Cryptoutil internal - crypto
        - pkg: cryptoutil/internal/common/crypto/asn1
          alias: cryptoutilAsn1
        - pkg: cryptoutil/internal/common/crypto/certificate
          alias: cryptoutilCertificate
        - pkg: cryptoutil/internal/common/crypto/digests
          alias: cryptoutilDigests
        - pkg: cryptoutil/internal/common/crypto/jose
          alias: cryptoutilJose
        - pkg: cryptoutil/internal/common/crypto/keygen
          alias: cryptoutilKeyGen
        # Cryptoutil internal - server
        - pkg: cryptoutil/internal/server/application
          alias: cryptoutilServerApplication
        - pkg: cryptoutil/internal/server/businesslogic
          alias: cryptoutilBusinessLogic
        - pkg: cryptoutil/internal/server/handler
          alias: cryptoutilOpenapiHandler
        - pkg: cryptoutil/internal/server/barrier
          alias: cryptoutilBarrierService
        - pkg: cryptoutil/internal/server/barrier/contentkeysservice
          alias: cryptoutilContentKeysService
        - pkg: cryptoutil/internal/server/barrier/intermediatekeysservice
          alias: cryptoutilIntermediateKeysService
        - pkg: cryptoutil/internal/server/barrier/rootkeysservice
          alias: cryptoutilRootKeysService
        - pkg: cryptoutil/internal/server/barrier/unsealkeysservice
          alias: cryptoutilUnsealKeysService
        - pkg: cryptoutil/internal/server/repository/orm
          alias: cryptoutilOrmRepository
        - pkg: cryptoutil/internal/server/repository/sqlrepository
          alias: cryptoutilSQLRepository
        # Cryptoutil internal - identity
        - pkg: cryptoutil/internal/identity/apperr
          alias: cryptoutilIdentityAppErr
        - pkg: cryptoutil/internal/identity/config
          alias: cryptoutilIdentityConfig
        - pkg: cryptoutil/internal/identity/domain
          alias: cryptoutilIdentityDomain
        - pkg: cryptoutil/internal/identity/magic
          alias: cryptoutilIdentityMagic
        - pkg: cryptoutil/internal/identity/repository
          alias: cryptoutilIdentityRepository
        - pkg: cryptoutil/internal/identity/issuer
          alias: cryptoutilIdentityIssuer
        - pkg: cryptoutil/internal/identity/authz
          alias: cryptoutilIdentityAuthz
        - pkg: cryptoutil/internal/identity/authz/clientauth
          alias: cryptoutilIdentityClientAuth
        - pkg: cryptoutil/internal/identity/idp
          alias: cryptoutilIdentityIdp
        - pkg: cryptoutil/internal/identity/idp/auth
          alias: cryptoutilIdentityAuth
        - pkg: cryptoutil/internal/identity/server
          alias: cryptoutilIdentityServer
        # Crypto packages
        - pkg: crypto/aes
          alias: aes
        - pkg: crypto/ecdsa
          alias: ecdsa
        - pkg: crypto/hmac
          alias: hmac
        - pkg: crypto/rsa
          alias: rsa
        - pkg: crypto/sha256
          alias: sha256
        - pkg: crypto/sha512
          alias: sha512
        - pkg: crypto/rand
          alias: crand

issues:
  max-issues-per-linter: 100
  max-same-issues: 20

severity:
  default: error
  rules:
    - linters:
        - revive
        - godot
      severity: warning
    - linters:
        - misspell
      severity: info
