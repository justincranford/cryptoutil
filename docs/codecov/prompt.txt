# CRYPTOUTIL PROJECT - REMAINING TASKS

**IMPORTANT:** Completed items are tracked in `docs/codecov/completed.txt`

## PRIORITY 1: Achieve 96% Coverage for cicd Package

### Task 1.4: Achieve 96%+ Coverage for cicd Package (CONTINUING)
- Current: 87.6% (was 82.4%, was 53.0%)
- Target: 96%+
- Need: +8.4% more coverage
- Add comprehensive tests for remaining untestable functions
- Add tests for edge cases and error paths
- Verify tests pass
- Commit: "test(cicd): achieve 96%+ coverage"

## PRIORITY 2: Database Performance Optimization (4 packages)

### Task 2.1: Optimize internal/server/repository/sqlrepository (CONTINUING)
- Current: 58.9% (was 52.6%)
- Target: 90%+
- Need: +31.1% more coverage
- Continue adding parameterized happy and sad path tests
- Add tests for error paths, PostgreSQL-specific code
- Optimize connection concurrency with robustness (SQLite special handling for write concurrency)
- Performance: Maximum performance for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Latency: Minimize latency for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Throughput: Maximum throughput for bulk transactions and CRUD statements (SQLite + PostgreSQL)
- Document findings in docs/DB-PERF-kms-sql.md (pros, cons, what went well, what needs improvement)
- Verify tests pass
- Commit: "perf(sqlrepository): optimize performance and add comprehensive tests"

### Task 2.2: Optimize internal/server/repository/orm (CONTINUING)
- Current: 81.3% (was 47.9%, was 29.7%)
- Target: 90%+
- Need: +8.7% more coverage
- Fix test isolation issues in barrier_operations_test.go (data persistence)
- Add business entity tests (ElasticKey, MaterialKey operations)
- Continue adding parameterized happy and sad path tests
- Optimize connection concurrency with robustness (SQLite special handling for write concurrency)
- Performance: Maximum performance for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Latency: Minimize latency for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Throughput: Maximum throughput for bulk transactions and CRUD statements (SQLite + PostgreSQL)
- Document findings in docs/DB-PERF-kms-sql.md (pros, cons, what went well, what needs improvement)
- Verify tests pass
- Commit: "perf(sqlrepository): optimize performance and add comprehensive tests"

### Task 2.2: Optimize internal/server/repository/orm
- Add parameterized happy and sad path tests
- Optimize connection concurrency with robustness (SQLite special handling for write concurrency)
- Performance: Maximum performance for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Latency: Minimize latency for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Throughput: Maximum throughput for bulk transactions and CRUD statements (SQLite + PostgreSQL)
- Document findings in docs/DB-PERF-kms-orm.md (pros, cons, what went well, what needs improvement)
- Verify tests pass
- Commit: "perf(orm): optimize performance and add comprehensive tests"

### Task 2.3: Optimize internal/identity/repository
- Add parameterized happy and sad path tests
- Optimize connection concurrency with robustness (SQLite special handling for write concurrency)
- Performance: Maximum performance for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Latency: Minimize latency for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Throughput: Maximum throughput for bulk transactions and CRUD statements (SQLite + PostgreSQL)
- Document findings in docs/DB-PERF-identity-sql.md (pros, cons, what went well, what needs improvement)
- Verify tests pass
- Commit: "perf(identity/repository): optimize performance and add comprehensive tests"

### Task 2.4: Optimize internal/identity/repository/orm
- Add parameterized happy and sad path tests
- Optimize connection concurrency with robustness (SQLite special handling for write concurrency)
- Performance: Maximum performance for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Latency: Minimize latency for individual transactions and CRUD statements (SQLite + PostgreSQL)
- Throughput: Maximum throughput for bulk transactions and CRUD statements (SQLite + PostgreSQL)
- Document findings in docs/DB-PERF-identity-orm.md (pros, cons, what went well, what needs improvement)
- Verify tests pass
- Commit: "perf(identity/orm): optimize performance and add comprehensive tests"

### Task 2.5: Create Database Performance Summary
- Create docs/DB-PERF-SUMMARY.md
- Compare and contrast approaches taken in each of the 4 DB packages
- Document similarities, differences, pros/cons of each approach
- Recommend improvements or optimizations that can be applied from each package to the other 3 DB-related packages
- Commit: "docs(db-perf): add comprehensive performance analysis summary"

## PRIORITY 3: Add Tests to 22 Additional Packages (one at a time)

### Task 3.1: internal/common/util
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(common/util): add comprehensive parameterized tests"

### Task 3.2: internal/common/config
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(common/config): add comprehensive parameterized tests"

### Task 3.3: internal/common/crypto/asn1
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(common/crypto/asn1): add comprehensive parameterized tests"

### Task 3.4: internal/common/telemetry
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(common/telemetry): add comprehensive parameterized tests"

### Task 3.5: internal/server/handler
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(server/handler): add comprehensive parameterized tests"

### Task 3.6: internal/server/barrier/unsealkeysservice
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(server/barrier/unsealkeysservice): add comprehensive parameterized tests"

### Task 3.7: internal/server/barrier/rootkeysservice
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(server/barrier/rootkeysservice): add comprehensive parameterized tests"

### Task 3.8: internal/server/barrier/intermediatekeysservice
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(server/barrier/intermediatekeysservice): add comprehensive parameterized tests"

### Task 3.9: internal/server/barrier/contentkeysservice
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(server/barrier/contentkeysservice): add comprehensive parameterized tests"

### Task 3.10: internal/server/application
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(server/application): add comprehensive parameterized tests"

### Task 3.11: internal/identity/authz/clientauth
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/authz/clientauth): add comprehensive parameterized tests"

### Task 3.12: internal/identity/authz/pkce
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/authz/pkce): add comprehensive parameterized tests"

### Task 3.13: internal/identity/authz
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/authz): add comprehensive parameterized tests"

### Task 3.14: internal/identity/domain
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/domain): add comprehensive parameterized tests"

### Task 3.15: internal/identity/idp
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/idp): add comprehensive parameterized tests"

### Task 3.16: internal/identity/idp/auth
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/idp/auth): add comprehensive parameterized tests"

### Task 3.17: internal/identity/idp/userauth
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/idp/userauth): add comprehensive parameterized tests"

### Task 3.18: internal/identity/issuer
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/issuer): add comprehensive parameterized tests"

### Task 3.19: internal/identity/rs
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/rs): add comprehensive parameterized tests"

### Task 3.20: internal/identity/security
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/security): add comprehensive parameterized tests"

### Task 3.21: internal/identity/server
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/server): add comprehensive parameterized tests"

### Task 3.22: internal/identity/storage/fixtures
- Add parameterized happy and sad path tests
- Verify tests pass
- Commit: "test(identity/storage/fixtures): add comprehensive parameterized tests"

## COMPLETED TASKS (for reference)

✅ Task 0.1: Refactor cicd.go cache outputs to .cicd/ subdirectory
✅ Task 0.2: Optimize go-update-direct-dependencies performance (5.86s → 3.2s, 46% improvement)
✅ Task 0.3: Enhanced cicd coverage from 53.0% to 82.4% (+29.4%)
  - Note: 96% was blocked by os.Exit() calls (now being addressed in Priority 1)
