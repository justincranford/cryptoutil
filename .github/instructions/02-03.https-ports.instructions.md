---
description: "HTTPS ports, bind addresses, TLS addresses, CORS Origins, TLS configuration, and request paths for public and admin endpoints"
applyTo: "**"
---
# Two HTTPS Endpoints - Tactical Guidance

**Reference**: See `.specify/memory/https-ports.md` for complete specifications (two HTTPS endpoints public/admin, binding parameters, TLS Subject Alt Names, CORS origins, ServerConfig pattern, deployment environments, TLS certificate configuration, health endpoints, request path prefixes, middleware stacks)

**This file contains ONLY tactical implementation patterns**

## Quick Reference

**Public Endpoint**: <https://127.0.0.1:8080> (business APIs, browser UIs)
**Private Endpoint**: <https://127.0.0.1:9090> (admin, health checks, graceful shutdown)

**MANDATORY: Two separate HTTPS servers for security/network isolation**

## Binding Defaults

**Public**: <https://127.0.0.1:8080> | **Private**: <https://127.0.0.1:9090>
**Tests**: port 0 (dynamic) | **Containers**: 0.0.0.0 (public only)

## ServerConfig Pattern

```go
type ServerConfig struct {
    BindPublicProtocol    string   // "https" (default)
    BindPublicAddress     string   // "127.0.0.1" (default), "0.0.0.0" (containers)
    BindPublicPort        uint16   // 8080 (default), 0 (tests)
    BindPrivateProtocol   string   // "https" (default)
    BindPrivateAddress    string   // "127.0.0.1" (default)
    BindPrivatePort       uint16   // 9090 (default), 0 (tests)
    TLSPublicDNSNames     []string // ["localhost"]
    TLSPublicIPAddresses  []string // ["127.0.0.1", "::1", "::ffff:127.0.0.1"]
    TLSPrivateDNSNames    []string // ["localhost"]
    TLSPrivateIPAddresses []string // ["127.0.0.1", "::1", "::ffff:127.0.0.1"]
    CORSAllowedOrigins    []string // 6 origins (http/https × localhost/127.0.0.1/[::1] × :8080)
}
```

**Configuration-driven binding**: Bind address MUST be configurable (127.0.0.1 for tests/dev, 0.0.0.0 for containers)

## Private HTTPS Endpoint (Admin Server)

**Purpose**: Administration, health checks, graceful shutdown

**Configuration**:

- Test ports: 0 (dynamic allocation)
- Production ports: 9090 (recommended)
- Bind address: 127.0.0.1 (all environments)
- TLS: HTTPS (always)

**Private HTTP APIs**:

- `/admin/v1/livez` - Liveness health probe (lightweight check)
- `/admin/v1/readyz` - Readiness health probe (heavyweight check)
- `/admin/v1/shutdown` - Graceful shutdown trigger

## Public HTTPS Endpoint (Public Server)

**Purpose**: Business APIs, browser UIs, external client access

## Request Path Prefixes and Middlewares

For Public HTTP endpoint, all services MUST implement TWO security middleware stacks:

**Service-to-Service APIs** (`/service/**` prefix):

- Access: Service clients ONLY; browser clients MUST be blocked
- Middleware: IP allowlist, rate limiting, request logging

**Browser-to-Service APIs/UI** (`/browser/**` prefix):

- Access: Browser clients ONLY; service clients MUST be blocked
- Middleware: CSRF protection, CORS policies, CSP headers, IP allowlist, rate limiting
- Additional content: HTML pages, JavaScript, CSS, images, fonts

**API Consistency**:

- SAME OpenAPI specification served at both `/service/api/v1/**` and `/browser/api/v1/**` paths
- Middleware enforces authorization mutual exclusivity (headless → /service/**, browser → /browser/**)
