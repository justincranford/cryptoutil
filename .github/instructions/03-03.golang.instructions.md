---
description: "Go project structure and standards"
applyTo: "**"
---
# Go Project Standards

## Quick Reference

**Go Version**: 1.25.7 (ALWAYS same everywhere: dev, CI/CD, Docker)
**CGO**: BANNED (CGO_ENABLED=0) except race detector
**Project Layout**: cmd, internal, pkg, api (avoid /src)

See [ARCHITECTURE.md Section 2.4 Implementation Strategy](../../docs/ARCHITECTURE.md#24-implementation-strategy) for comprehensive Go best practices and testing strategy.

## Go Version Consistency

**MANDATORY: Use same Go version everywhere** (development, CI/CD, Docker, documentation)

**Enforcement Locations**: `go.mod`, `.github/workflows/*.yml`, `Dockerfile`, `README.md`

See [ARCHITECTURE.md Section 11.1.1 Go Version Consistency](../../docs/ARCHITECTURE.md#1111-go-version-consistency) and [Section 2.2 Architecture Strategy](../../docs/ARCHITECTURE.md#22-architecture-strategy) for version consistency requirements across all environments.

## CGO Ban - CRITICAL

**CGO_ENABLED=0 is MANDATORY** (except race detector `-race` which requires CGO_ENABLED=1).

**Rationale**: Maximum portability, static linking, cross-compilation.

**CGO-free alternatives**: modernc.org/sqlite (NOT mattn/go-sqlite3).

See [ARCHITECTURE.md Section 11.1.2 CGO Ban - CRITICAL](../../docs/ARCHITECTURE.md#1112-cgo-ban---critical) for comprehensive CGO ban rationale and enforcement.

## Import Aliases

`cryptoutil<Package>` for internal, `<vendor><Package>` for external.

See [ARCHITECTURE.md Section 11.1.3 Import Alias Conventions](../../docs/ARCHITECTURE.md#1113-import-alias-conventions) for import alias patterns and enforcement.

## Magic Values Locations

- **ALL magic constants MUST be consolidated in `internal/shared/magic/`** — no scattered package-local magic files
- **Shared**: `internal/shared/magic/magic_*.go`
- **Domain-Specific**: `internal/shared/magic/magic_domain*.go`
- **`internal/shared/magic/` is excluded from coverage and mutation thresholds** — constants only, no executable logic

See [ARCHITECTURE.md Section 11.1.4 Magic Values Organization](../../docs/ARCHITECTURE.md#1114-magic-values-organization) for magic values location patterns and mnd linter enforcement.

## Go Project Structure

```
cryptoutil/
+-- cmd/                                   # Binary entry points
|   +-- cryptoutil/main.go                 # Suite: -> internal/apps/cryptoutil/
|   +-- cipher-im/main.go                  # Service: -> internal/apps/cipher/im/
|   +-- jose-ja/main.go                    # Service: -> internal/apps/jose/ja/
|   +-- pki-ca/main.go                     # Service: -> internal/apps/pki/ca/
|   +-- identity-{authz,idp,rp,rs,spa}/    # Service: -> internal/apps/identity/{svc}/
|   +-- sm-kms/main.go                     # Service: -> internal/apps/sm/kms/
|   +-- cipher/main.go                     # Product: -> internal/apps/cipher/
|   +-- jose/main.go                       # Product: -> internal/apps/jose/
|   +-- pki/main.go                        # Product: -> internal/apps/pki/
|   +-- identity/main.go                   # Product: -> internal/apps/identity/
|   +-- sm/main.go                         # Product: -> internal/apps/sm/
+-- internal/
|   +-- apps/                              # Applications: PRODUCT/SERVICE/
|   +-- shared/                            # Shared utilities
|   |   +-- barrier/                       # Encryption-at-rest (Unseal, Root, Intermediate, Content)
|   |   +-- crypto/{asn1,certificate,digests,hash,jose,keygen,keygenpool,tls}/
|   |   +-- magic/                         # Named constants
|   |   +-- pool/                          # High-performance key gen pool
|   |   +-- telemetry/                     # OpenTelemetry
+-- api/                                   # OpenAPI specs, generated code
+-- pkg/                                   # Public library code
```

**Key Rules**: No `/src` directory, no deep nesting (>8 levels), use `/internal` for private code.

See [ARCHITECTURE.md Section 4.4.1 Go Project Structure](../../docs/ARCHITECTURE.md#441-go-project-structure) for complete project layout and directory rules.

## CLI Patterns

### Product-Service Pattern

`cmd/PRODUCT-SERVICE/main.go SUBCOMMAND` -> `internal/app/PRODUCT/SERVICE/SERVICE.go SUBCOMMAND`

SUBCOMMANDs: server, client, health, livez, readyz, shutdown, init, compose, demo, e2e.

### Product Pattern

`cmd/PRODUCT/main.go SERVICE SUBCOMMAND` -> 1-to-1 or 1-to-N recursion to services.

Product-level SUBCOMMANDs (recurse to all services): health, readyz, livez, shutdown, init, compose, demo, e2e.

### Suite Pattern

`cmd/cryptoutil/main.go PRODUCT SERVICE SUBCOMMAND` -> product -> service -> subcommand.

### Anti-Patterns

**NO executables for subcommands**: `cmd/cryptoutil-health/main.go` NOT allowed. `cmd/sm-im-server/main.go` NOT allowed.

See [ARCHITECTURE.md Section 4.4.7 CLI Patterns](../../docs/ARCHITECTURE.md#447-cli-patterns) for CLI pattern rules and anti-patterns.

See [ARCHITECTURE.md Section 9.1 CLI Patterns & Strategy](../../docs/ARCHITECTURE.md#91-cli-patterns--strategy) for comprehensive CLI architecture.

## Application Architecture

**Layers**: main() [cmd/] -> Application [internal/*/application/] -> Business Logic [internal/*/service/, domain/] -> Repositories [internal/*/repository/] -> Database

**Configuration**: YAML + CLI flags + Docker/K8s secrets. NO environment variables.

**Design Patterns**: Constructor injection, context propagation, graceful shutdown, factory pattern, error wrapping (`fmt.Errorf("failed to X: %w", err)`).

See [ARCHITECTURE.md Section 4.3 Component Architecture](../../docs/ARCHITECTURE.md#43-component-architecture) and [Section 5.1 Service Template Pattern](../../docs/ARCHITECTURE.md#51-service-template-pattern) for layered architecture and design patterns.

## Import Alias Conventions

```go
import (
    cryptoutilMagic "cryptoutil/internal/shared/magic"
    cryptoutilServer "cryptoutil/internal/server"
    crand "crypto/rand"
    googleUuid "github.com/google/uuid"
    jose "github.com/go-jose/go-jose/v4"
)
```

<!-- @source from="docs/ARCHITECTURE.md" as="crypto-acronyms-caps" -->
**Crypto Acronyms**: ALWAYS ALL CAPS: RSA, EC, ECDSA, ECDH, HMAC, AES, JWA, JWK, JWS, JWE, ED25519, PKCS8, PEM, DER.
<!-- @/source -->

See [ARCHITECTURE.md Section 11.1.3 Import Alias Conventions](../../docs/ARCHITECTURE.md#1113-import-alias-conventions) for import alias conventions and crypto acronym capitalization.
