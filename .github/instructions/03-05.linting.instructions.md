---
description: "Code quality, linting, and maintenance"
applyTo: "**"
---
# Linting

## MANDATORY: Zero Linting Errors

**ALL code must pass linting - NO EXCEPTIONS** (production, tests, demos, examples, utilities)

- NEVER use `//nolint:` except for documented linter bugs with GitHub issue reference
- ALWAYS run `golangci-lint run --fix` FIRST (handles formatting, imports, auto-fixable linters)
- FIX ALL issues before committing (no exceptions for any code)

**Pre-Commit Hooks**: Run same linters and formatters as CI/CD workflows (golangci-lint, gofumpt, goimports). See `.pre-commit-config.yaml` for complete hook configuration.

See [ARCHITECTURE.md Section 11.3.3 Code Quality Enforcement](../../docs/ARCHITECTURE.md#1133-code-quality-enforcement), [Section 2.5 Quality Strategy](../../docs/ARCHITECTURE.md#25-quality-strategy), and [Section 9.9 Pre-Commit Hook Architecture](../../docs/ARCHITECTURE.md#99-pre-commit-hook-architecture) for comprehensive quality enforcement patterns.

## Quick Reference: golangci-lint v2

**Current Version**: v2.7.2 (minimum)

**v2 Changes**:

- `wsl` -> `wsl_v5` config key
- Built-in gofumpt/goimports with `--fix`
- Removed: `wsl.force-err-cuddling`, `misspell.ignore-words`, `wrapcheck.ignoreSigs`

See [ARCHITECTURE.md Section 11.3.1 Linter Configuration Architecture](../../docs/ARCHITECTURE.md#1131-linter-configuration-architecture) and [Section 2.5 Quality Strategy](../../docs/ARCHITECTURE.md#25-quality-strategy) for golangci-lint v2 configuration and version-specific syntax.

## Critical Rules

**wsl**: NEVER use `//nolint:wsl` - restructure code to group related logic
**godot**: ALWAYS end comments with periods (auto-fixable)
**mnd**: Declare magic values in `internal/common/magic/` or package-specific `magic*.go`

See [ARCHITECTURE.md Section 11.3.3 Code Quality Enforcement](../../docs/ARCHITECTURE.md#1133-code-quality-enforcement) and [Section 2.5 Quality Strategy](../../docs/ARCHITECTURE.md#25-quality-strategy) for critical linter rules and enforcement patterns.

## Linter Categories

**Auto-Fixable** (--fix): wsl, gofmt, gofumpt, goimports, godot, goconst, importas, copyloopvar, testpackage, revive
**Manual-Fix**: errcheck, gosimple, govet, ineffassign, staticcheck, unused, gosec, noctx, wrapcheck, thelper, tparallel, gomodguard, prealloc, bodyclose, errorlint, stylecheck

See [ARCHITECTURE.md Section 11.3.1 Linter Configuration Architecture](../../docs/ARCHITECTURE.md#1131-linter-configuration-architecture) for complete linter categorization and auto-fix workflows.

## Domain Isolation Check

```bash
# Verify identity module cannot import server/client/api
go run ./cmd/cicd go-check-identity-imports
```

## Workflow

```bash
golangci-lint run --fix                          # Auto-fix formatters + auto-fixable linters
golangci-lint run --build-tags e2e,integration --fix  # Auto-fix build-tagged files
golangci-lint run                                # Check remaining manual fixes
golangci-lint run --build-tags e2e,integration  # Check build-tagged files
git commit -m "style: fix linting issues"
```

See [ARCHITECTURE.md Section 11.2 Quality Gates](../../docs/ARCHITECTURE.md#112-quality-gates) and [Section 9.9 Pre-Commit Hook Architecture](../../docs/ARCHITECTURE.md#99-pre-commit-hook-architecture) for linting workflow patterns and quality gate enforcement.

## Secret Detection

Use `gosec` (part of golangci-lint): G401 (weak crypto), G501 (import blocklist), G505 (weak random).

See [ARCHITECTURE.md Section 6.2 SDLC Security Strategy](../../docs/ARCHITECTURE.md#62-sdlc-security-strategy) for secret detection and security gate enforcement.

## Batch Lint Fixing

Use `multi_replace_string_in_file` for efficiency (up to 10 similar fixes per batch).

See [ARCHITECTURE.md Section 11.3.3 Code Quality Enforcement](../../docs/ARCHITECTURE.md#1133-code-quality-enforcement) for batch fixing patterns and automation.

## UTF-8 BOM

**MANDATORY**: UTF-8 without BOM for ALL text files (`cicd all-enforce-utf8` pre-commit hook).

See [ARCHITECTURE.md Section 2.5 Quality Strategy](../../docs/ARCHITECTURE.md#25-quality-strategy) and [Section 9.9 Pre-Commit Hook Architecture](../../docs/ARCHITECTURE.md#99-pre-commit-hook-architecture) for UTF-8 BOM enforcement and pre-commit hook patterns.

## Version Pinning - MANDATORY

**ALWAYS pin golangci-lint to specific version** in CI/CD, pre-commit, and documentation. NEVER use `@latest`.

See [ARCHITECTURE.md Section 2.2 Architecture Strategy](../../docs/ARCHITECTURE.md#22-architecture-strategy) and [Section 9.7 CI/CD Workflow Architecture](../../docs/ARCHITECTURE.md#97-cicd-workflow-architecture) for version pinning requirements and CI/CD version consistency.
