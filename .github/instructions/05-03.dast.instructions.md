---
description: "Instructions for Dynamic Application Security Testing (DAST): Nuclei scanning, ZAP testing, and workflow execution"
applyTo: "**"
---
# DAST Instructions - Tactical Guidance

**Reference**: See `.specify/memory/dast.md` for complete specifications (CI-DAST lessons learned, variable expansion in heredocs, debugging workflow PostgreSQL issues, preventive checklist, Nuclei scanning, OWASP ZAP)

**This file contains ONLY tactical implementation patterns**

## Variable Expansion in Heredocs - CRITICAL

**ALWAYS use `${VAR}` syntax (curly braces), NEVER `$VAR`**:

```yaml
- name: Generate config
  run: |
    cat > config.yml <<EOF
    database-url: "postgres://${POSTGRES_USER}:${POSTGRES_PASS}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_NAME}"
    EOF

    # Verification step (MANDATORY)
    cat config.yml
```

**Historical Mistake**: ci-dast used `$POSTGRES_USER` instead of `${POSTGRES_USER}` → wrote literal "$POSTGRES_USER" to config → PostgreSQL error "role 'root' does not exist"

## Debugging PostgreSQL Issues Checklist

1. Download workflow artifacts (container logs, PostgreSQL logs)
2. Check PostgreSQL logs for "FATAL: role '<username>' does not exist"
3. Verify credentials (workflow env vars vs service container env vars)
4. Check config generation output (search logs for `cat config.yml`)
5. Verify variable expansion (ensure values expanded, not literal `$VAR`)
6. Compare with working workflows (ci-coverage, ci-mutation, ci-race)

## Nuclei Scanning Commands

**Prerequisites** (start services first):

```bash
docker compose -f ./deployments/compose/compose.yml up -d
sleep 30
```

**Quick scan** (info/low):

```bash
nuclei -target https://localhost:8080/ -severity info,low
```

**Comprehensive scan** (medium/high/critical):

```bash
nuclei -target https://localhost:8080/ -severity medium,high,critical
```

**Performance-optimized**:

```bash
nuclei -target https://localhost:8080/ -c 25 -rl 100 -severity high,critical
```
