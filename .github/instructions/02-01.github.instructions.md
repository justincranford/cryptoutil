---
description: "Instructions for CI/CD workflow configuration, service connectivity verification, and diagnostic logging"
applyTo: "**"
---
# CI/CD Workflow Instructions

## Cost Efficiency
- Use path filters to trigger workflows only on relevant changes
- Minimal matrix builds; skip jobs for docs-only changes
- Use `cache: true` on `actions/setup-go@v6` (not manual cache actions)

## Workflow Matrix
| Workflow | Services | Purpose |
|----------|----------|---------|
| ci-quality | None | Linting, formatting, builds |
| ci-coverage | None | Test coverage |
| ci-benchmark | None | Performance benchmarks |
| ci-fuzz | None | Fuzz testing |
| ci-race | None | Race detection |
| ci-sast | None | Static security analysis |
| ci-gitleaks | None | Secrets scanning |
| ci-dast | PostgreSQL | Dynamic security testing |
| ci-e2e | Full Docker stack | E2E integration |
| ci-load | Full Docker stack | Load testing |

## Service Connectivity Patterns
**No services**: ci-quality, ci-coverage, ci-benchmark, ci-fuzz, ci-race, ci-sast, ci-gitleaks
**Go-based E2E**: ci-e2e uses `internal/test/e2e/` infrastructure (Docker Compose + health checks)
**Bash verification**: ci-dast, ci-load use `curl -k https://127.0.0.1:808X/ui/swagger/doc.json`

## Configuration Management
- ALWAYS use config files for production/CI (not environment variables)
- Tests use SQLite in-memory (`--dev` flag)
- NEVER use environment variables for secrets

## Artifact Management
- Upload artifacts with `actions/upload-artifact@v5.0.0` + `if: always()`
- Upload SARIF to Security tab with `github/codeql-action/upload-sarif@v3`
- Retention: 1 day temporary, 1-30 days valuable reports

## Act Workflow Testing
```bash
go run ./cmd/workflow -workflows=dast -inputs="scan_profile=quick"  # 3-5 min
go run ./cmd/workflow -workflows=dast -inputs="scan_profile=full"   # 10-15 min
go run ./cmd/workflow -workflows=e2e,dast                            # Multiple
```
NEVER use `-t` timeout flag; ALWAYS let cmd/workflow complete

## Diagnostic Logging
Steps >10s MUST include timing: `START_TIME=$(date +%s)` ... `DURATION=$((END_TIME - START_TIME))`
Emojis: ğŸ“‹ start, ğŸ“… timestamps, â±ï¸ duration, âœ… success, âŒ error
