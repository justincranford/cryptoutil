---
description: "Instructions for platform-specific tooling: PowerShell, scripts, Docker pre-pull"
applyTo: "**"
---
# Platform-Specific Tooling Instructions

## Command Usage Restrictions

### Curl/Wget Command Usage Rules

**CRITICAL: Context-specific curl/wget restrictions**

####  BANNED in Copilot Chat Sessions (Local Windows PowerShell)
- **NEVER use curl or wget in chat sessions** - not installed in Windows path
- **Alternative**: Use PowerShell `Invoke-WebRequest`
- **Exception**: Examples in documentation showing CI/CD usage are acceptable if clearly marked as workflow-only

####  ALLOWED in GitHub Actions Workflows (.github/workflows/*.yml)
- **curl and wget are both available** in GitHub Actions Ubuntu runners and act containers
- **Preferred**: wget with "--no-check-certificate" option for HTTPS endpoints
- **Why**: GitHub runners and act containers have both tools preinstalled

####  ALLOWED in Docker Compose Healthchecks (compose.yml)
- **Preferred**: Use `wget` (available in Alpine/busybox containers)
- **Fallback**: Use `curl` if container includes it (e.g., grafana-otel-lgtm)
- **Pattern**: `test: ["CMD", "wget", "--no-check-certificate", "-q", "-O", "/dev/null", "https://127.0.0.1:9090/livez"]`
- **Why**: Most containers use Alpine base which includes wget via busybox

## Authorized Commands for Chat Sessions

### Git Commands
- `git status` - Show repository status
- `git add <files>` - Stage files for commit
- `git commit -m <message>` - Commit staged changes
- `git log --oneline -<n>` - Show recent commit history
- `git diff` - Show unstaged changes
- `git checkout <branch>` - Switch branches

### Go Commands
- `go test ./<path>` - Run tests in specified path
- `go build ./<path>` - Build packages
- `go mod tidy` - Clean up module dependencies
- `go run ./<path>` - Run Go program
- `golangci-lint run` - Run linter (relies on exclusions in .golangci-lint.yml)
- `go test -fuzz=. -fuzztime=15s ./<path>` - Run fuzz tests for 15 seconds (ALWAYS from project root)
- `go test -run=FuzzXXX -fuzz=FuzzXXX -fuzztime=15s ./<path>` - Run specific fuzz test (use PowerShell `;` not bash `&&`)

### Docker Compose Commands
- `docker compose ps` - List container status
- `docker compose logs <service>` - View service logs
- `docker compose logs <service> --tail <n>` - View recent service logs
- `docker compose exec <service> <command>` - Execute command in container
- `docker compose build <services>` - Build services
- `docker compose up -d <services>` - Start services in background
- `docker compose down -v` - Stop services and remove volumes

### Docker Commands
- `docker inspect <container>` - Inspect container (without --format to avoid authorization)
- `docker ps` - List containers (without --filter/--format to avoid authorization)
- `docker stats` - Show container resource usage
- `docker top` - Show container processes
- `docker inspect --format` - Inspect with custom formatting

### File/Directory Operations
- `pwd` - Show current working directory
- `ls -la <path>` - List directory contents with details
- `dir` - List directory contents (PowerShell equivalent)
- `find <path> -name <pattern>` - Find files by name pattern
- `cat <file>` - Display file contents
- `type <file>` - Display file contents (PowerShell equivalent)
- `head -n <lines> <file>` - Show first N lines of file
- `tail -n <lines> <file>` - Show last N lines of file
- `grep <pattern> <file>` - Search for patterns in files
- `Select-String <pattern> <file>` - Search for patterns in files (PowerShell equivalent)

### Build/Test Tools
- `make <target>` - Run Makefile targets
- `npm run <script>` - Run npm scripts
- `python -m <module>` - Run Python modules
- `pytest <path>` - Run Python tests
- `./mvnw <goals>` - Run Maven goals with Maven Wrapper
- `mvnw.cmd <goals>` - Run Maven goals with Maven Wrapper on Windows

### System Commands
- `which <command>` - Find command location
- `echo <text>` - Display text
- `date` - Show current date/time
- `sleep <seconds>` - Pause execution

## Commands Requiring Manual Authorization

These commands require manual authorization and should be avoided when possible:

### Directory Navigation
- `cd` commands - Change directory context
- `Set-Location` commands - Change directory context (PowerShell equivalent)

### Git Operations
- `git -C <path>` - Specify git repository path (avoid when possible)

### Network Commands
- `curl.exe` - Make HTTP requests (use docker compose exec instead for container access)
- `tee` - Output redirection to files (E2E tests already log automatically)

## PowerShell Development

### Execution
- Use `powershell -NoProfile -ExecutionPolicy Bypass -File script.ps1` (process-scoped)
- Alternative: `Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass`
- NEVER change `-Scope LocalMachine` or `-Scope CurrentUser`

### Syntax
- **ALWAYS use PowerShell `;` for command chaining** - never use bash `&&` syntax (PowerShell 5.1 doesn't support it)
- Use `;` for chaining, `$env:VAR` for environment variables
- Bash equivalents: `| Select-Object -First 10` (head), `| Select-String` (grep)
- Avoid emojis/Unicode in here-strings
- No `&&` or `||` in v5.1  use `;` or `if ($LASTEXITCODE -eq 0) { cmd2 }`

### Common Errors
- Switch defaults: avoid `[switch]$Param = $true`
- String interpolation: use single quotes `'literal $var'` for literals
- Variable expansion: use `${variable}` for clarity
- File slicing: read to array first: `$lines = Get-Content file; $lines[10..20]`

## Cross-Platform Script Development

### Language Preferences

**ALWAYS prefer Go for new scripts** when:
- Cross-platform compatibility needed
- Complex logic or data processing required
- Performance-critical operations
- Need for static compilation and distribution
- Structured error handling and testing required

**PowerShell/Bash appropriate** when:
- Platform-specific system administration tasks
- Quick automation of platform-specific workflows
- Simple file operations or environment setup

### Go Script Guidelines
- Place scripts in `scripts/` directory
- Use `cmd/` subdirectory for main entry points
- Follow standard Go project layout
- Use Go modules for dependency management
- Implement proper error handling with context
- Use structured logging (slog package)
- Provide CLI interface with flag package

### PowerShell/Bash Script Pairings
- Always provide both .ps1 and .sh versions
- Follow existing patterns (lint.ps1/lint.sh model)
- Ensure consistent functionality and parameter naming
- Provide consistent help/usage information
- Ensure executable permissions for Unix scripts

### Script Testing (CRITICAL)
- **ALWAYS test scripts before committing**
- Test both PowerShell and Bash versions on their platforms
- For PowerShell: Test with execution policy restrictions
- Test help/usage: `script.ps1 -Help` and `script.sh --help`
- Test error conditions and edge cases
- Verify cleanup and resource management
- Test with different parameter combinations

## Docker Image Pre-Pull Optimization

### Pattern for CI/CD Workflows

**Add pre-pull step BEFORE first Docker usage**:

```yaml
- name: Pre-pull Docker images (parallel)
  run: |
    echo " Pre-pulling all Docker images in parallel..."

    IMAGES=(
      "postgres:18"
      "ghcr.io/zaproxy/zaproxy:stable"
      "alpine:latest"
    )

    for image in "${IMAGES[@]}"; do
      echo "Pulling $image..."
      docker pull "$image" &
    done

    wait

    echo " All images pre-pulled successfully"
```

### Common Images by Workflow

**DAST Workflow**:
- `postgres:18`
- `ghcr.io/zaproxy/zaproxy:stable`

**E2E Workflow**:
- `postgres:18`
- `alpine:3.19`
- `golang:1.25.3`

**Quality Workflow**:
- `alpine:3.19`
- `golang:1.25.3`

### Benefits
- **Parallel downloads**: All images download simultaneously
- **Faster workflows**: Reduces total pull time by 50-80%
- **Better diagnostics**: Clear separation of pull failures vs runtime failures
- **Cached layers**: Docker BuildKit cache benefits from having base images present

### When to Skip
- Workflow uses only GitHub Actions (no direct Docker commands)
- Single image used once (minimal benefit)
- Images already cached by previous steps
