---
description: "Instructions for OpenAPI"
applyTo: "**"
---
# OpenAPI

## Quick Reference

**Version**: OpenAPI 3.0.3 (NOT 2.0/Swagger, NOT 3.1.x). **Content**: application/json only.

See [ARCHITECTURE.md Section 8. API Architecture](../../docs/ARCHITECTURE.md#8-api-architecture) for OpenAPI version requirements and API design patterns.

## File Organization

- `openapi_spec_components.yaml` - Reusable components (schemas, responses, parameters)
- `openapi_spec_paths.yaml` - API endpoints and operations

See [ARCHITECTURE.md Section 8.1 OpenAPI-First Design](../../docs/ARCHITECTURE.md#81-openapi-first-design) for OpenAPI file organization and component patterns.

## Code Generation (oapi-codegen)

Three config files per service:
1. **Server** (`openapi-gen_config_server.yaml`): `strict-server: true`, output `api/server/server.gen.go`
2. **Model** (`openapi-gen_config_model.yaml`): `models: true`, output `api/model/models.gen.go`
3. **Client** (`openapi-gen_config_client.yaml`): `client: true`, output `api/client/client.gen.go`

See [ARCHITECTURE.md Section 8.1 OpenAPI-First Design](../../docs/ARCHITECTURE.md#81-openapi-first-design) for code generation configuration and oapi-codegen usage.

## Strict Server - MANDATORY

**ALWAYS `strict-server: true`**: Type safety, request validation before handler, consistent errors.

```go
type StrictServerInterface interface {
    CreateKey(ctx context.Context, request CreateKeyRequest) (CreateKeyResponse, error)
}
```

See [ARCHITECTURE.md Section 8.1 OpenAPI-First Design](../../docs/ARCHITECTURE.md#81-openapi-first-design) for strict server pattern and type safety requirements.

## Validation Rules

**String**: `format: uuid`, `enum`, `minLength/maxLength`, `pattern`
**Number**: `minimum/maximum`, `multipleOf`
**Array**: `minItems/maxItems`, `uniqueItems: true`
**Object**: `required: [...]`, nested properties

See [ARCHITECTURE.md Section 8.1 OpenAPI-First Design](../../docs/ARCHITECTURE.md#81-openapi-first-design) for validation rule patterns and OpenAPI schema usage.

## HTTP Status Codes

<!-- @source from="docs/ARCHITECTURE.md" as="http-status-codes" -->
| Code | Usage |
|------|-------|
| 200 | GET, PUT, PATCH successful |
| 201 | POST (resource created) |
| 204 | DELETE successful |
| 400 | Validation error |
| 401 | Missing/invalid auth |
| 403 | Insufficient permissions |
| 404 | Resource not found |
| 409 | Duplicate/conflict |
| 422 | Semantic validation error |
| 500 | Unhandled server error |
| 503 | Temporary unavailability |
<!-- @/source -->

See [ARCHITECTURE.md Section 8.4 Error Handling](../../docs/ARCHITECTURE.md#84-error-handling) for status code usage patterns and error handling.

## REST Conventions

**Naming**: Plural nouns (`/keys`), singular singletons (`/config`), kebab-case (`/api-keys`).
**Methods**: GET (list/get), POST (create), PUT (replace), PATCH (update), DELETE (remove).
**Idempotency**: GET, PUT, DELETE idempotent; POST NOT.

See [ARCHITECTURE.md Section 8.2 REST Conventions](../../docs/ARCHITECTURE.md#82-rest-conventions) for REST naming, methods, and idempotency patterns.

## Pagination - MANDATORY

All list endpoints: `page` (default 1, min 1), `size` (default 50, min 1, max 1000). Response includes `items` + `pagination` (page, size, total).

See [ARCHITECTURE.md Section 8.2 REST Conventions](../../docs/ARCHITECTURE.md#82-rest-conventions) for pagination patterns and response structure.

## Error Schema

```yaml
Error:
  type: object
  required: [code, message]
  properties:
    code: {type: string}
    message: {type: string}
    details: {type: object, additionalProperties: true}
    requestId: {type: string, format: uuid}
```

See [ARCHITECTURE.md Section 8.4 Error Handling](../../docs/ARCHITECTURE.md#84-error-handling) for error schema structure and error response patterns.

## Cross-References

See [ARCHITECTURE.md Section 8. API Architecture](../../docs/ARCHITECTURE.md#8-api-architecture) for comprehensive API design including OpenAPI-first design, REST conventions, versioning, error handling, and security.

See [ARCHITECTURE.md Section 8.3 API Versioning](../../docs/ARCHITECTURE.md#83-api-versioning) for backward compatibility requirements (N-1 support) and versioning strategy.

See [ARCHITECTURE.md Section 8.5 API Security](../../docs/ARCHITECTURE.md#85-api-security) for API security patterns including authn/authz requirements per path type.
