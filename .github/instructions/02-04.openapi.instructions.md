---
description: "Instructions for OpenAPI"
applyTo: "**"
---
# OpenAPI

## Quick Reference

**Version**: OpenAPI 3.0.3 (NOT 2.0/Swagger, NOT 3.1.x). **Content**: application/json only.

## File Organization

- `openapi_spec_components.yaml` - Reusable components (schemas, responses, parameters)
- `openapi_spec_paths.yaml` - API endpoints and operations

## Code Generation (oapi-codegen)

Three config files per service:
1. **Server** (`openapi-gen_config_server.yaml`): `strict-server: true`, output `api/server/server.gen.go`
2. **Model** (`openapi-gen_config_model.yaml`): `models: true`, output `api/model/models.gen.go`
3. **Client** (`openapi-gen_config_client.yaml`): `client: true`, output `api/client/client.gen.go`

## Strict Server - MANDATORY

**ALWAYS `strict-server: true`**: Type safety, request validation before handler, consistent errors.

```go
type StrictServerInterface interface {
    CreateKey(ctx context.Context, request CreateKeyRequest) (CreateKeyResponse, error)
}
```

## Validation Rules

**String**: `format: uuid`, `enum`, `minLength/maxLength`, `pattern`
**Number**: `minimum/maximum`, `multipleOf`
**Array**: `minItems/maxItems`, `uniqueItems: true`
**Object**: `required: [...]`, nested properties

## HTTP Status Codes

| Code | Usage |
|------|-------|
| 200 | GET, PUT, PATCH successful |
| 201 | POST (resource created) |
| 204 | DELETE successful |
| 400 | Validation error |
| 401 | Missing/invalid auth |
| 403 | Insufficient permissions |
| 404 | Resource not found |
| 409 | Duplicate/conflict |
| 422 | Semantic validation error |
| 500 | Unhandled server error |
| 503 | Temporary unavailability |

## REST Conventions

**Naming**: Plural nouns (`/keys`), singular singletons (`/config`), kebab-case (`/api-keys`).
**Methods**: GET (list/get), POST (create), PUT (replace), PATCH (update), DELETE (remove).
**Idempotency**: GET, PUT, DELETE idempotent; POST NOT.

## Pagination - MANDATORY

All list endpoints: `page` (default 1, min 1), `size` (default 50, min 1, max 1000). Response includes `items` + `pagination` (page, size, total).

## Error Schema

```yaml
Error:
  type: object
  required: [code, message]
  properties:
    code: {type: string}
    message: {type: string}
    details: {type: object, additionalProperties: true}
    requestId: {type: string, format: uuid}
```
