---
description: "Authentication and authorization patterns"
applyTo: "**"
---
# Authentication & Authorization

## Key Principles

- **Zero Trust**: NO caching of authorization decisions. Re-evaluate every request.
- **MFA Step-Up**: Re-authentication MANDATORY every 30 minutes for high-sensitivity operations.
- **Session Storage**: SQL databases ONLY (PostgreSQL or SQLite with ACID). NEVER Redis/Memcached.
- **mTLS Revocation**: MUST check BOTH CRLDP and OCSP. Fail if BOTH unreachable.

## Headless Authentication (13 Methods, `/service/**` only)

**Non-Federated (6)**: JWE Session Token, JWS Session Token, Opaque Session Token, Basic (Client ID/Secret), Bearer (API Token), HTTPS Client Certificate.

**Federated (7)**: Basic/Bearer/ClientCert via OAuth 2.1, JWE/JWS/Opaque Access Token, Opaque Refresh Token.

**Storage**: YAML + SQL (Config > DB priority) for all methods.

## Browser Authentication (28 Methods, `/browser/**` only)

**Non-Federated (6)**: JWE/JWS/Opaque Session Cookie, Basic (Username/Password), Bearer (API Token), HTTPS Client Certificate.

**Federated (22)**: All non-federated methods PLUS:
- **MFA Factors**: TOTP, HOTP, Recovery Codes, WebAuthn (with/without Passkeys), Push Notification
- **Passwordless**: Email/Password, Magic Link (Email/SMS), Random OTP (Email/SMS/Phone)
- **Social Login**: Google, Microsoft, GitHub, Facebook, Apple, LinkedIn, Twitter/X, Amazon, Okta
- **Enterprise**: SAML 2.0

**Storage**: YAML + SQL (Config > DB) for static credentials. SQL ONLY for dynamic user data (OTPs, enrollments, magic links).

## Session Token Formats

**Opaque** (UUID), **JWE** (encrypted JWT), **JWS** (signed JWT). Storage: PostgreSQL (distributed) or SQLite (single-node). NO Redis/Memcached.

## Authorization Methods

**Headless**: Scope-based, RBAC.
**Browser**: Scope-based, RBAC, resource-level ACLs, consent tracking (scope+resource granularity).

## MFA Combinations

**Browser**: Password + TOTP/WebAuthn/Push/OTP.
**Headless**: Client ID/Secret + mTLS/Bearer.
