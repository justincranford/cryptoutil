---
description: "Authentication and authorization patterns"
applyTo: "**"
---
# Authentication & Authorization

## Key Principles

<!-- @source from="docs/ARCHITECTURE.md" as="key-principles" -->
- **Zero Trust**: NO caching of authorization decisions. Re-evaluate every request.
- **MFA Step-Up**: Re-authentication MANDATORY every 30 minutes for high-sensitivity operations.
- **Session Storage**: SQL databases ONLY (PostgreSQL or SQLite with ACID). NEVER Redis/Memcached.
- **mTLS Revocation**: MUST check BOTH CRLDP and OCSP. Fail if BOTH unreachable.
<!-- @/source -->

See [ARCHITECTURE.md Section 6.9 Authentication & Authorization](../../docs/ARCHITECTURE.md#69-authentication--authorization) for comprehensive authentication and authorization patterns.

## Headless Authentication (13 Methods, `/service/**` only)

<!-- @source from="docs/ARCHITECTURE.md" as="headless-authn" -->
**Non-Federated (6)**: JWE Session Token, JWS Session Token, Opaque Session Token, Basic (Client ID/Secret), Bearer (API Token), HTTPS Client Certificate.

**Federated (7)**: Basic/Bearer/ClientCert via OAuth 2.1, JWE/JWS/Opaque Access Token, Opaque Refresh Token.

**Storage**: YAML + SQL (Config > DB priority) for all methods.
<!-- @/source -->

See [ARCHITECTURE.md Section 6.9.2 Headless Authentication Methods](../../docs/ARCHITECTURE.md#692-headless-authentication-methods-13-total) for detailed headless authentication patterns.

## Browser Authentication (28 Methods, `/browser/**` only)

<!-- @source from="docs/ARCHITECTURE.md" as="browser-authn" -->
**Non-Federated (6)**: JWE/JWS/Opaque Session Cookie, Basic (Username/Password), Bearer (API Token), HTTPS Client Certificate.

**Federated (22)**: All non-federated methods PLUS:
- **MFA Factors**: TOTP, HOTP, Recovery Codes, WebAuthn (with/without Passkeys), Push Notification
- **Passwordless**: Email/Password, Magic Link (Email/SMS), Random OTP (Email/SMS/Phone)
- **Social Login**: Google, Microsoft, GitHub, Facebook, Apple, LinkedIn, Twitter/X, Amazon, Okta
- **Enterprise**: SAML 2.0

**Storage**: YAML + SQL (Config > DB) for static credentials. SQL ONLY for dynamic user data (OTPs, enrollments, magic links).
<!-- @/source -->

See [ARCHITECTURE.md Section 6.9.3 Browser Authentication Methods](../../docs/ARCHITECTURE.md#693-browser-authentication-methods-28-total) and [Section 7.2.1 Authentication Realms](../../docs/ARCHITECTURE.md#721-authentication-realms) for browser authentication patterns and realm types.

## Session Token Formats

<!-- @source from="docs/ARCHITECTURE.md" as="session-token-formats" -->
**Opaque** (UUID), **JWE** (encrypted JWT), **JWS** (signed JWT). Storage: PostgreSQL (distributed) or SQLite (single-node). NO Redis/Memcached.
<!-- @/source -->

See [ARCHITECTURE.md Section 6.9.1 Authentication Realm Architecture](../../docs/ARCHITECTURE.md#691-authentication-realm-architecture) and [Section 7.2.1 Authentication Realms](../../docs/ARCHITECTURE.md#721-authentication-realms) for session token format details and storage patterns.

## Authorization Methods

<!-- @source from="docs/ARCHITECTURE.md" as="authz-methods" -->
**Headless**: Scope-based, RBAC.
**Browser**: Scope-based, RBAC, resource-level ACLs, consent tracking (scope+resource granularity).
<!-- @/source -->

See [ARCHITECTURE.md Section 6.9.5 Authorization Patterns](../../docs/ARCHITECTURE.md#695-authorization-patterns) for authorization method details and zero-trust principles.

## MFA Combinations

<!-- @source from="docs/ARCHITECTURE.md" as="mfa-combinations" -->
**Browser**: Password + TOTP/WebAuthn/Push/OTP.
**Headless**: Client ID/Secret + mTLS/Bearer.
<!-- @/source -->

See [ARCHITECTURE.md Section 6.9.4 Multi-Factor Authentication (MFA)](../../docs/ARCHITECTURE.md#694-multi-factor-authentication-mfa) for MFA combination patterns and step-up authentication requirements.
