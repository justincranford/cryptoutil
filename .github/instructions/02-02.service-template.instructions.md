---
description: "Service template requirements and patterns for all cryptoutil services"
applyTo: "**"
---
# Service Template - Tactical Guidance

**Reference**: See `.specify/memory/service-template.md` for complete specifications (template components, parameterization, migration priority)

**This file contains ONLY tactical implementation patterns**

## Template Components Quick Reference

- **Two HTTPS Servers**: Public (business) + Admin (health checks)
- **Two Public Paths**: `/browser/**` (sessions) vs `/service/**` (tokens)
- **Three Admin APIs**: `/admin/v1/livez`, `/admin/v1/readyz`, `/admin/v1/shutdown`
- **Database**: PostgreSQL || SQLite with GORM
- **Telemetry**: OTLP → otel-collector-contrib sidecar
- **Config**: YAML + CLI flags + Docker secrets

## Migration Priority

1. **learn-ps FIRST**: Validate template works (all tests, workflows, no blockers)
2. **One at a time**: jose-ja → pki-ca → identity services (sequential refactoring)
3. **sm-kms LAST**: Only after all others running excellently

## NEVER DO

- ❌ Copy-paste service infrastructure code
- ❌ Duplicate dual-server, health checks, shutdown logic
- ❌ Reimplement middleware, telemetry, crypto, GORM setup
