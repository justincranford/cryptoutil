---
description: "Instructions for Spec Kit workflow and spec-driven development"
applyTo: "**"
---
# Spec Kit Instructions

## Overview

Spec Kit enables spec-driven development for cryptoutil. Use these instructions to maintain specifications, validate work against requirements, and ensure iterative refinement through grooming sessions.

## Spec Kit Files

### Constitution (`.specify/memory/constitution.md`)

The constitution defines immutable project principles:

- **FIPS 140-3 Compliance First**: All crypto operations use approved algorithms
- **Evidence-Based Task Completion**: No task complete without verifiable evidence
- **Hierarchical Key Security**: Multi-layer cryptographic barrier architecture
- **Code Quality Excellence**: ALL linting errors MANDATORY to fix
- **Product Architecture Clarity**: Clear infrastructure/product separation

**NEVER modify core principles without explicit stakeholder approval.**

### Specification (`specs/001-cryptoutil/spec.md`)

The specification defines WHAT the system does:

- Product capabilities (JOSE, Identity, KMS, Certificates)
- API endpoints and their status
- Infrastructure components
- Quality requirements

**Update spec.md when**:

- Adding new features or capabilities
- Changing API contracts
- Updating status of existing features

### Plan (`specs/001-cryptoutil/plan.md`)

The plan defines HOW and WHEN to implement:

- Implementation phases with timelines
- Task breakdowns with priorities
- Success criteria
- Risk management

**Update plan.md when**:

- Starting a new phase
- Completing milestones
- Adjusting timelines or priorities

## Grooming Sessions

### Purpose

Grooming sessions use multiple-choice questions to:

1. Validate understanding of requirements
2. Identify ambiguities in specifications
3. Refine implementation details
4. Ensure alignment between spec and implementation

### Session Structure

Each grooming session (`docs/speckit/passthru##/grooming/GROOMING-SESSION-##.md`):

- Contains 50 multiple-choice questions
- Covers specific topics or phases
- Questions have 4 options (A, B, C, D)
- One correct answer per question
- Explanation provided for each answer

### How to Use Grooming Sessions

1. **Review Questions**: Read all 50 questions
2. **Answer Questions**: Select best answer for each
3. **Check Answers**: Compare with provided answers
4. **Identify Gaps**: Note questions answered incorrectly
5. **Update Specs**: Refine specification based on gaps
6. **Repeat**: Create new session if needed

### Creating New Grooming Sessions

When creating `GROOMING-SESSION-##.md`:

```markdown
# Grooming Session ##: [Topic]

## Overview
- **Focus Area**: [Specific area being refined]
- **Related Spec Section**: [Link to spec section]
- **Prerequisites**: [Required knowledge]

## Questions

### Q1: [Question text]
A) [Option A]
B) [Option B]
C) [Option C]
D) [Option D]

**Answer**: [Letter]
**Explanation**: [Why this answer is correct]

---

[... 49 more questions ...]
```

## Workflow Integration

### Starting New Work

1. Read `constitution.md` for principles
2. Read relevant section of `spec.md`
3. Check `plan.md` for current phase
4. Complete relevant grooming session
5. Begin implementation

### During Implementation

1. Reference spec for requirements
2. Follow plan for priorities
3. Validate against constitution principles
4. Create incremental commits

### Completing Work

1. Verify against spec requirements
2. Update PROJECT-STATUS.md
3. Mark plan tasks complete
4. Run grooming session to validate

## Spec Kit CLI Commands

```bash
# Check Spec Kit status
specify check

# Validate specification
specify validate

# Generate tasks from spec
specify tasks

# Run agent workflows
specify agent
```

## File Locations

| File | Path | Purpose |
|------|------|---------|
| Constitution | `.specify/memory/constitution.md` | Core principles |
| Specification | `specs/001-cryptoutil/spec.md` | Product definition |
| Plan | `specs/001-cryptoutil/plan.md` | Implementation roadmap |
| Grooming | `docs/speckit/passthru##/grooming/*.md` | Refinement sessions |
| Templates | `.specify/templates/*.md` | Document templates |
| Agents | `.github/agents/speckit.*.agent.md` | Agent configurations |
| Prompts | `.github/prompts/speckit.*.prompt.md` | Prompt templates |

## Best Practices

### Specification Quality

- Use tables for structured data
- Include status indicators (✅, ⚠️, ❌)
- Link to related documentation
- Version all specifications

### Grooming Quality

- Questions should be unambiguous
- All options should be plausible
- Explanations should teach, not just state
- Cover edge cases and error scenarios

### Plan Quality

- Tasks should be actionable
- Include level of effort (LOE) estimates
- Define clear success criteria
- Identify dependencies and risks

## Anti-Patterns to Avoid

- ❌ Modifying constitution without approval
- ❌ Implementing without checking spec
- ❌ Skipping grooming sessions
- ❌ Creating specs without validation
- ❌ Leaving spec status outdated

## Integration with Existing Instructions

Spec Kit complements existing instruction files:

| Instruction | Integration |
|-------------|-------------|
| `01-01.coding` | Constitution enforces coding patterns |
| `01-02.testing` | Spec defines coverage targets |
| `01-05.security` | Constitution embeds FIPS requirements |
| `05-01.evidence-based` | Grooming validates evidence collection |
