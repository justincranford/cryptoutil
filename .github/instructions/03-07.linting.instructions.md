---
description: "Instructions for code quality, linting, and maintenance standards"
applyTo: "**"
---
# Linting and Code Quality - Tactical Guidance

**Reference**: See `.specify/memory/linting.md` for complete specifications (linter rules, auto-fix vs manual-fix, domain isolation)

**This file contains ONLY tactical implementation patterns**

## MANDATORY: Zero Linting Errors

**ALL code must pass linting - NO EXCEPTIONS** (production, tests, demos, examples, utilities)

- NEVER use `//nolint:` except for documented linter bugs with GitHub issue reference
- ALWAYS run `golangci-lint run --fix` FIRST (handles formatting, imports, auto-fixable linters)
- FIX ALL issues before committing (no exceptions for any code)

## Quick Reference: golangci-lint v2

**Current Version**: v2.6.2 (minimum)

**v2 Changes**:
- `wsl` → `wsl_v5` config key
- Built-in gofumpt/goimports with `--fix`
- Removed: `wsl.force-err-cuddling`, `misspell.ignore-words`, `wrapcheck.ignoreSigs`

## Critical Linter Rules

**wsl**: NEVER use `//nolint:wsl` - restructure code to group related logic

**godot**: ALWAYS end comments with periods (auto-fixable)

```go
// Package cryptoutil provides utilities.  // ✓
// NewCipher creates a cipher instance.    // ✓
```

**mnd**: Declare magic values in `internal/common/magic/` or package-specific `magic*.go`

```go
const defaultPort = 8080  // ✓
// NOT: server.Start(8080)  // ✗
```

## Linter Categories

**Auto-Fixable** (--fix support): wsl, gofmt, gofumpt, goimports, godot, goconst, importas, copyloopvar, testpackage, revive

**Manual-Fix Required**: errcheck, gosimple, govet, ineffassign, staticcheck, unused, gosec, noctx, wrapcheck, thelper, tparallel, gomodguard, prealloc, bodyclose, errorlint, stylecheck

## Domain Isolation Check

```bash
# Verify identity module cannot import server/client/api
go run ./cmd/cicd go-check-identity-imports
```

## Key Takeaways

1. **Zero Exceptions**: ALL code must pass linting (including tests, demos)
2. **Always --fix First**: `golangci-lint run --fix` before manual fixes
3. **wsl Restructure**: Never suppress, restructure code to group related logic
4. **UTF-8 without BOM**: All text files (enforced by `cicd all-enforce-utf8`)
5. **Batch Fixes**: Use `multi_replace_string_in_file` for efficiency (up to 10 similar fixes)
