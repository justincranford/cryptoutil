---
description: "Code quality, linting, and maintenance"
applyTo: "**"
---
# Linting

## MANDATORY: Zero Linting Errors

**ALL code must pass linting - NO EXCEPTIONS** (production, tests, demos, examples, utilities)

- NEVER use `//nolint:` except for documented linter bugs with GitHub issue reference
- ALWAYS run `golangci-lint run --fix` FIRST (handles formatting, imports, auto-fixable linters)
- FIX ALL issues before committing (no exceptions for any code)

**Pre-Commit Hooks**: Run same linters and formatters as CI/CD workflows (golangci-lint, gofumpt, goimports). See `.pre-commit-config.yaml` for complete hook configuration.

## Quick Reference: golangci-lint v2

**Current Version**: v2.7.2 (minimum)

**v2 Changes**:

- `wsl` -> `wsl_v5` config key
- Built-in gofumpt/goimports with `--fix`
- Removed: `wsl.force-err-cuddling`, `misspell.ignore-words`, `wrapcheck.ignoreSigs`

## Critical Rules

**wsl**: NEVER use `//nolint:wsl` - restructure code to group related logic
**godot**: ALWAYS end comments with periods (auto-fixable)
**mnd**: Declare magic values in `internal/common/magic/` or package-specific `magic*.go`

## Linter Categories

**Auto-Fixable** (--fix): wsl, gofmt, gofumpt, goimports, godot, goconst, importas, copyloopvar, testpackage, revive
**Manual-Fix**: errcheck, gosimple, govet, ineffassign, staticcheck, unused, gosec, noctx, wrapcheck, thelper, tparallel, gomodguard, prealloc, bodyclose, errorlint, stylecheck

## Domain Isolation Check

```bash
# Verify identity module cannot import server/client/api
go run ./cmd/cicd go-check-identity-imports
```

## Workflow

```bash
golangci-lint run --fix  # Auto-fix formatters + auto-fixable linters
golangci-lint run        # Check remaining manual fixes
git commit -m "style: fix linting issues"
```

## Secret Detection

Use `gosec` (part of golangci-lint): G401 (weak crypto), G501 (import blocklist), G505 (weak random).

## Batch Lint Fixing

Use `multi_replace_string_in_file` for efficiency (up to 10 similar fixes per batch).

## UTF-8 BOM

**MANDATORY**: UTF-8 without BOM for ALL text files (`cicd all-enforce-utf8` pre-commit hook).

## Version Pinning - MANDATORY

**ALWAYS pin golangci-lint to specific version** in CI/CD, pre-commit, and documentation. NEVER use `@latest`.
