---
description: "Instructions for code quality and maintenance standards"
applyTo: "**"
---
# Code Quality Instructions

- Implement proper resource cleanup (defer statements for HTTP bodies, files, etc.)
- Maintain clear function boundaries (avoid high cyclomatic complexity)
- Remove unused code and parameters
- Validate input parameters in mapper and utility functions
- Wrap all external package errors with context using fmt.Errorf and %w verb to satisfy wrapcheck linter
- Use Go context for HTTP requests and long-running operations to satisfy noctx linter (http.NewRequestWithContext, t.Context() in tests)
- Follow maintenance guidelines in files: immediately remove completed/obsolete tasks from actionable lists

## Pre-commit Hook Documentation Maintenance

**CRITICAL**: When modifying any of these files, review and update `docs/pre-commit-hooks.md`:
- `.pre-commit-config.yaml` - Hook ordering, tool configuration, exclusions
- `.golangci.yml` - Linter configuration, enabled/disabled linters, severity settings
- `.gofumpt.toml` - Go formatting rules and module path
- `.gremlins.yaml` - Mutation testing configuration (if it affects pre-commit indirectly)
- `internal/cmd/cicd/cicd.go` - Test pattern enforcement logic
- `scripts/setup-pre-commit.ps1` / `setup-pre-commit.bat` - Setup script changes
- `.vscode/settings.json` - VS Code integration with pre-commit tools

**What to update in docs/pre-commit-hooks.md**:
- Tool ordering changes in pipeline flow diagram and stage breakdown table
- New/removed tools in configuration sections
- Parameter changes in tool-specific sections (args, exclusions, files patterns)
- Integration changes (VS Code settings, golangci-lint config references)
- New troubleshooting guidance for common issues

**Pre-commit Configuration Guidelines:**
- **NEVER use shell commands** (`sh`, `bash`, `powershell`) in pre-commit configurations
- Use cross-platform tools directly (e.g., `go`, `python`) or pre-commit's built-in hooks
- Ensure all hooks work on Windows, Linux, and macOS without shell dependencies
- New troubleshooting guidance for common issues

## Linter Compliance

- **ALWAYS rely on golangci-lint exclusions defined in .golangci-lint.yml** - never use --skip-files or --skip-dirs command line flags
- **ALWAYS use `golangci-lint run --fix` FIRST for auto-fixing before any manual lint error fixing** - this ensures all auto-fixable issues are resolved automatically before attempting manual fixes - this single command handles formatting (gofumpt), imports (goimports), and all other auto-fixable linters in one pass
- **CRITICAL: gofumpt is ALWAYS preferred over gofmt in ALL SITUATIONS** - gofumpt is a stricter superset of gofmt with additional formatting rules; NEVER use `gofmt` directly, even if you see a "gofmt" lint error from any tool including golangci-lint
- **Pre-commit hooks automatically run `golangci-lint run --fix`** - no need to run standalone gofumpt or goimports commands separately
- **ALWAYS declare values as constants near the top of the file** to proactively mitigate "mnd" (magic number detector) linter errors in .golangci-lint.yml:
  - **HTTP status codes**: `http.StatusOK`, `http.StatusNotFound`, `http.StatusForbidden` instead of `200`, `404`, `403`
  - **Durations**: `timeout = 30 * time.Second`, `delay = 100 * time.Millisecond` instead of inline `30000`, `100`
  - **Special strings**: `statusPass = "PASS"`, `statusFail = "FAIL"`` instead of inline strings
  - **Special numbers**: `rsaKeySize2048 = 2048`, `aes256KeySize = 256` instead of magic numbers
  - **Port numbers**: `publicPort = 8080`, `privateAdminPort = 9090` instead of `8080`, `9090`
  - **Common counts/limits**: `maxRetries = 3` instead of `3`
  - **File permissions**: `fileMode = 0o600`, `dirMode = 0o755` instead of `0o600`, `0o755`
- **CRITICAL: cicd.go and cicd_test.go contains deliberate lint violations for testing purposes** - these files MUST exclude themselves from their own directory walks, to avoid self-referencing and modifying themselves during auto-fixing; all other validations in golangci-lint must still be performed on both files

## Code Patterns

- **Default Values**: Always declare default values as named variables (e.g., `var defaultConfigFiles = []string{}`) rather than inline literals, following the established pattern in config.go
- **Pass-through Calls**: When making pass-through calls to helper functions, prefer using the same parameter order and return value order as the helper function to maintain API consistency and reduce confusion
