---
description: "Public HTTPS bind address configuration patterns"
applyTo: "**"
---
# Public HTTPS Bind Address Pattern - NEVER VIOLATE

**MANDATORY: Public HTTPS endpoints MUST be documented as `<configurable_address>:<configurable_port>` - NEVER hardcode `0.0.0.0`**

## Why This Matters

- **Container deployments**: Use `0.0.0.0` bind address (enables external access)
- **Test/dev environments**: Use `127.0.0.1` bind address (prevents Windows Firewall prompts)
- **Configuration-driven**: Bind address MUST be configurable, not hardcoded to `0.0.0.0`

## Pattern Recognition

- ❌ WRONG: "Public API (0.0.0.0:configurable)" - hardcodes container-only pattern
- ❌ WRONG: "Public API (0.0.0.0:8080)" - hardcodes both address and port
- ✅ CORRECT: "Public API (<configurable_address>:<configurable_port>)" - fully configurable
- ✅ CORRECT: In code: `bindAddress := config.PublicBindAddress` (NEVER hardcode "0.0.0.0")

## Why `0.0.0.0` is Wrong in Documentation

- Implies public endpoints ALWAYS bind to all interfaces (not true for tests/dev)
- Contradicts constitution.md requirement: "Public endpoints MAY use configurable IPv4 or IPv6 bind address"
- Prevents Windows development: `0.0.0.0` triggers Firewall prompts, blocks automation
- Misleads implementers: Suggests hardcoding instead of configuration

## Correct Documentation Pattern

```markdown
**Dual HTTPS Servers**: Public API (<configurable_address>:<configurable_port>) + Admin API (127.0.0.1:9090)
```

## Correct Implementation Pattern

```go
// Configuration structure
type ServerConfig struct {
    PublicBindAddress string // Default: "127.0.0.1" (tests/dev), "0.0.0.0" (containers)
    PublicPort        int    // Configurable port
    AdminBindAddress  string // ALWAYS "127.0.0.1" (never configurable)
    AdminPort         int    // ALWAYS 9090 (never configurable)
}

// Server binding
publicAddr := fmt.Sprintf("%s:%d", config.PublicBindAddress, config.PublicPort)
adminAddr := "127.0.0.1:9090" // Admin NEVER configurable
```

## Where This Pattern Appears

- constitution.md Section V (Service Architecture)
- spec.md (Service Template Extraction, Dual HTTPS Pattern)
- PLAN.md (Core Requirements)
- 02-01.architecture.instructions.md (Two Endpoint HTTPS Architecture Pattern)

## Enforcement

When writing documentation about public HTTPS endpoints, ALWAYS use `<configurable_address>:<configurable_port>` pattern. When implementing, ALWAYS read bind address from configuration.
