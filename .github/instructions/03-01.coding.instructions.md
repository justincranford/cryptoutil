---
description: "Instructions for coding patterns and standards"
applyTo: "**"
---
# Coding

## File Size Limits

**Soft limit**: 300 lines (ideal target)
**Medium limit**: 400 lines (acceptable with justification)
**Hard limit**: 500 lines -> refactor required

See [ARCHITECTURE.md Section 11.2.6 File Size Limits](../../docs/ARCHITECTURE.md#1126-file-size-limits) and [Section 13.1 Coding Standards](../../docs/ARCHITECTURE.md#131-coding-standards) for file size enforcement and rationale.

## Code Patterns

### Default Values

**ALWAYS declare default values as named variables** rather than inline literals.

```go
var defaultPort = 8080
server.Start(defaultPort)  // CORRECT
server.Start(8080)         // WRONG
```

### Pass-through Calls

**Prefer same parameter and return value order** as helper functions.

### Context Reading Before Refactoring - CRITICAL

**ALWAYS read complete package context before refactoring** (NEVER refactor in isolation).

**Key Questions**: Why does this code exist? What protections are in place? Are "verbose" comments intentional? What tests validate this behavior?

### Conditional Statement Chaining

**PREFER SWITCH STATEMENTS** over `if/else if/else` chains:

```go
switch {
case ctx == nil:
    return nil, fmt.Errorf("nil context")
case logger == nil:
    return nil, fmt.Errorf("nil logger")
default:
    return processValid(ctx, logger, description)
}
```

**ALWAYS chain if/else if/else** for mutually exclusive conditions (not separate if statements).

See [ARCHITECTURE.md Section 11.1.4 Magic Values Organization](../../docs/ARCHITECTURE.md#1114-magic-values-organization), [Section 11.2.7 Conditional Statement Patterns](../../docs/ARCHITECTURE.md#1127-conditional-statement-patterns), and [Section 13.1 Coding Standards](../../docs/ARCHITECTURE.md#131-coding-standards) for comprehensive code pattern requirements.

## Validator Error Aggregation Pattern

<!-- @source from="docs/ARCHITECTURE.md" as="validator-error-aggregation" -->
All validators run to completion (never short-circuit) and aggregate errors for a single unified report. Sequential execution ensures deterministic output ordering. Aggregated errors (not fail-fast) show ALL problems in one run, reducing fix-test-fix cycles. `validate-all` returns exit code 0 if all pass, exit code 1 if any fail.
<!-- @/source -->

See [ARCHITECTURE.md Section 12.8 Validator Error Aggregation Pattern](../../docs/ARCHITECTURE.md#128-validator-error-aggregation-pattern) for execution model and rationale.

## Format_go Self-Modification Protection - CRITICAL

<!-- @source from="docs/ARCHITECTURE.md" as="format-go-protection" -->
**MANDATORY Prevention Rules**:
- NEVER change ` +""+interface{}+""+ ` to ` +""+ny+""+ ` in format_go package
- NEVER simplify CRITICAL/SELF-MODIFICATION comments
- ALWAYS read complete package context (enforce_any.go, filter.go, magic_cicd.go, format_go_test.go, self_modification_test.go) before modifying
<!-- @/source -->
See [ARCHITECTURE.md Section 11.2.8 format_go Self-Modification Protection - CRITICAL](../../docs/ARCHITECTURE.md#1128-format_go-self-modification-protection---critical) for root cause analysis and MANDATORY prevention rules.
