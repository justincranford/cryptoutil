---
description: "Instructions for local Git commands and commit conventions"
applyTo: "**"
---
# Git and Documentation Instructions - Tactical Guidance

**Reference**: See `.specify/memory/git.md` for complete specifications (conventional commits, incremental commit strategy, restore from clean baseline pattern, terminal command auto-approval, PowerShell notes, pull request descriptions, session documentation strategy)

**This file contains ONLY tactical implementation patterns**

## Conventional Commits Format

**Format**: `<type>[optional scope]: <description>`

**Types**: feat, fix, docs, style, refactor, perf, test, build, ci, chore, revert

**Examples**:
```bash
feat(auth): add OAuth2 client credentials flow
fix(database): prevent connection pool exhaustion
feat(api)!: remove deprecated v1 endpoints  # Breaking change
```

## Incremental vs Amend - CRITICAL

**ALWAYS commit incrementally (NOT amend)**:
```bash
# ✅ CORRECT
git commit -m "fix(format_go): restore clean baseline from 07192eac"
git commit -m "fix(format_go): add defensive check with filepath.Abs()"
git commit -m "test(format_go): verify self_modification_test catches regressions"

# ❌ WRONG - loses history, hard to bisect
git commit -m "fix"
git commit --amend  # Repeatedly amending loses context
```

**Why**: Preserves history, enables bisect, allows selective revert, shows thought process

## Restore from Clean Baseline Pattern

**When fixing regressions, ALWAYS restore clean baseline FIRST**:

```bash
# 1. Find last known-good commit
git log --oneline --grep="baseline" | head -5

# 2. Restore entire package from clean commit
git checkout <clean-commit-hash> -- path/to/package/

# 3. Verify baseline works
go test ./path/to/package/

# 4. Apply targeted fix ONLY (minimal change)
# Edit specific file

# 5. Verify fix independently
go test ./path/to/package/

# 6. Commit as NEW commit (not amend)
git commit -m "fix(package): add defensive check for X"
```

**Why**: HEAD may be corrupted from previous failed attempts. Start from known-good state.

## Session Documentation Strategy

**ALWAYS append to `specs/001-cryptoutil/implement/DETAILED.md` Section 2**:

```markdown
### YYYY-MM-DD: Brief Session Title
- Work completed: Summary (commit hashes)
- Key findings: Discoveries or blockers
- Coverage/quality metrics: Before/after
- Violations found: Issues discovered
- Next steps: Outstanding work
```

**NEVER create standalone session docs**: `docs/SESSION-*.md`, `docs/session-*.md`, `docs/analysis-*.md`

## PowerShell Notes

- Chain commands with `;` (NOT `&&`)
- No `sed` by default - use `git diff -- <file>` instead
- Use `Get-Content file | Select-String 'pattern'` for grep-like searches

