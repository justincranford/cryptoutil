---
description: "Products and services architecture patterns"
applyTo: "**"
---
# Products & Services Architecture - Tactical Guidance

**Reference**: See `.specify/memory/architecture.md` for complete specifications (service catalog, federation patterns, graceful degradation, testing requirements)

**This file contains ONLY tactical implementation patterns**

## Quick Reference: Service Ports

| Service | Public API | Admin API |
|---------|-----------|-----------|
| sm-kms | 8080-8089 | 9090 |
| pki-ca | 8443-8449 | 9090 |
| jose-ja | 9443-9449 | 9090 |
| identity-* | 18000-18409 | 9090 |
| learn-ps | 8888-8889 | 9090 |

## Federation Configuration Example

```yaml
federation:
  identity_url: "https://identity-authz:8180"
  identity_enabled: true
  identity_timeout: 10s
  jose_url: "https://jose-server:8280"

federation_fallback:
  identity_fallback_mode: "local_validation"
  jose_fallback_mode: "internal_crypto"
```

## Key Patterns

- **Service Discovery**: Config file → Docker Compose → Kubernetes DNS
- **Graceful Degradation**: Circuit breakers + fallback modes + retry strategies
- **Health Monitoring**: Poll federated services every 30s, activate fallback on errors
- **Cross-Service Auth**: mTLS (preferred) or OAuth 2.1 client credentials
