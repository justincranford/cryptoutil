---
description: "Instructions for observability and monitoring implementation"
applyTo: "**"
---
# Observability and Monitoring - Tactical Guidance

**Reference**: See `.specify/memory/observability.md` for complete specifications (OpenTelemetry stack, telemetry forwarding architecture, sidecar pattern MANDATORY, push-based flow, structured logging, OTLP export, health endpoints, Prometheus metrics, log levels, sensitive data protection)

**This file contains ONLY tactical implementation patterns**

## Quick Reference: Telemetry Flow

```
cryptoutil services (OTLP gRPC:4317 or HTTP:4318)
  → opentelemetry-collector (sidecar)
  → grafana-otel-lgtm (OTLP gRPC:14317 or HTTP:14318)
```

**MANDATORY**: ALWAYS forward through sidecar (NEVER bypass)

## Configuration Pattern

```yaml
# cryptoutil-otel.yml
telemetry:
  otlp_endpoint: "opentelemetry-collector:4317"  # Sidecar, not upstream
  protocol: "grpc"  # grpc (default) or http (firewall-friendly)
```

## Key Patterns

**Structured Logging**:
```go
log.Info("operation completed",
  "user_id", userID,
  "operation", "key_generation",
  "duration_ms", duration.Milliseconds(),
)
```

**Health Endpoints**:
- `/admin/v1/livez` - Lightweight (process alive?)
- `/admin/v1/readyz` - Heavyweight (dependencies healthy?)

**Sensitive Data**: NEVER log passwords, keys, PII (log IDs, operations, durations only)
