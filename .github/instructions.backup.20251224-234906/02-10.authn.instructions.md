---
description: "Authentication and authorization tactical implementation patterns"
applyTo: "**"
---
# Authentication and Authorization - Tactical Guidance

**Reference**: See `.specify/memory/authn-authz-factors.md` for complete specifications (10 headless + 28 browser authentication methods, storage realms, MFA combinations, authorization methods)

**This file contains ONLY tactical implementation patterns**

### Zero Trust Authorization Pattern

**MANDATORY: NO caching of authorization decisions**

### MFA Step-Up Pattern

**30-Minute Re-Authentication**:

### Testing Pattern

**Comprehensive Factor Testing**:

Test all 10 headless + 28 browser methods for comprehensive coverage, and parallel for robustness.

---

## Session State Storage - MANDATORY

**MUST use SQL databases ONLY (PostgreSQL or SQLite)**:

- NEVER use Redis, Memcached, or in-memory stores for session state
- Reason: ACID guarantees, durability, crash recovery, multi-region replication
- Pattern: Session tokens stored in `sessions` table with expiry, user_id, MFA timestamp

## mTLS Revocation Checking - MANDATORY

**MUST check BOTH CRLDP and OCSP**:

- CRLDP (CRL Distribution Points): Download CRL from certificate extension
- OCSP (Online Certificate Status Protocol): Real-time revocation check
- Pattern: Parallel checks, fail if BOTH unreachable, cache CRLs with TTL
- Configuration: `revocation_check_enabled: true` (default)

## Common Pitfalls

❌ Cache authz decisions, use Redis/Memcached for sessions, skip MFA step-up, assume realm availability, skip revocation checks
✅ Re-evaluate authz every request, use PostgreSQL/SQLite (ACID), enforce 30min MFA step-up, implement realm failover, check CRLDP+OCSP

---
