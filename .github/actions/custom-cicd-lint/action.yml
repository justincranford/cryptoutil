name: 'custom-cicd-lint'
description: 'Build cicd binary and run custom linting and validation checks'
runs:
  using: 'composite'
  steps:
    - name: Build cicd binary for quality checks
      shell: bash
      run: |
        echo "ğŸ”¨ Building cicd binary..."
        START_TIME=$(date +%s)
        echo "ğŸ“… Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        go build -o cicd ./cmd/cicd
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "ğŸ“… End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "â±ï¸ cicd binary built in: ${DURATION}s"

    - name: Enforce file encoding (UTF-8 without BOM)
      shell: bash
      run: |
        echo "ğŸ”¤ Enforcing UTF-8 file encoding..."
        START_TIME=$(date +%s)
        echo "ğŸ“… Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        ./cicd all-enforce-utf8
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "ğŸ“… End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "â±ï¸ UTF-8 enforcement completed in: ${DURATION}s"

    - name: Enforce test patterns
      shell: bash
      run: |
        echo "ğŸ§ª Enforcing test patterns..."
        START_TIME=$(date +%s)
        echo "ğŸ“… Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        ./cicd go-enforce-test-patterns
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "ğŸ“… End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "â±ï¸ Test pattern enforcement completed in: ${DURATION}s"

    - name: Run custom Go source code fixes
      shell: bash
      run: |
        echo "ğŸ”§ Running custom Go source code fixes..."
        START_TIME=$(date +%s)
        echo "ğŸ“… Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        ./cicd go-enforce-any
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "ğŸ“… End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "â±ï¸ Custom Go fixes completed in: ${DURATION}s"

    - name: Check for circular Go package dependencies
      shell: bash
      run: |
        echo "ğŸ”„ Checking for circular Go package dependencies..."
        START_TIME=$(date +%s)
        echo "ğŸ“… Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        ./cicd go-check-circular-package-dependencies
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "ğŸ“… End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "â±ï¸ Circular dependency check completed in: ${DURATION}s"

    - name: Check Go direct dependencies
      shell: bash
      run: |
        echo "ğŸ“¦ Checking Go direct dependencies..."
        START_TIME=$(date +%s)
        echo "ğŸ“… Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        ./cicd go-update-direct-dependencies
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "ğŸ“… End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "â±ï¸ Direct dependencies check completed in: ${DURATION}s"

    - name: Check GitHub Actions versions
      shell: bash
      run: |
        echo "ğŸ”„ Checking GitHub Actions versions..."
        START_TIME=$(date +%s)
        echo "ğŸ“… Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        ./cicd github-workflow-lint
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "ğŸ“… End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "â±ï¸ GitHub Actions version check completed in: ${DURATION}s"
