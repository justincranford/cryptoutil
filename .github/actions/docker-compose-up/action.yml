# $schema: https://json.schemastore.org/github-action.json
# Doc: https://docs.github.com/en/actions/creating-actions/metadata-syntax-for-github-actions

name: 'docker-compose-up'
description: 'Start Docker Compose services and wait for health checks'
inputs:
  compose-file:
    description: 'Path to the docker-compose file'
    required: false
    default: './deployments/compose/compose.yml'
runs:
  using: 'composite'
  steps:
    - name: Start Docker Compose services
      shell: bash
      run: |
        echo "üöÄ Starting Docker Compose services..."
        START_TIME=$(date +%s)
        echo "üìÖ Start: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        docker compose -f ${{ inputs.compose-file }} up -d

        echo "‚è≥ Waiting for services to be healthy..."
        timeout 60s bash -c 'until docker compose -f ${{ inputs.compose-file }} ps | grep -q "healthy"; do echo "Waiting..."; sleep 5; done' || echo "‚ö†Ô∏è Health check timeout - continuing anyway"

        echo "üìã Service status:"
        docker compose -f ${{ inputs.compose-file }} ps
        END_TIME=$(date +%s)
        DURATION=$((END_TIME - START_TIME))
        echo "üìÖ End: $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
        echo "‚è±Ô∏è Docker Compose services startup completed in: ${DURATION}s"
