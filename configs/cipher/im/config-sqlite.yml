# Cipher IM (Instant Messenger) Service Configuration - SQLite Instance
# This file contains instance-specific settings for cipher-im-sqlite

# Service Information
service:
  name: "cipher-im-sqlite"
  description: "Cipher-IM SQLite instance for E2E testing"
  version: "1.0.0"

# Observability Configuration
observability:
  service_name: "cipher-im-sqlite"
  otlp_endpoint: "http://cipher-im-otel-collector:4317"
  otlp_protocol: "grpc"
  metrics_enabled: true
  traces_enabled: true
  resource_attributes:
    service.version: "1.0.0"
    deployment.environment: "development"
    instance: "sqlite"

# Database Configuration
database:
  type: "sqlite"
  dsn: "file::memory:?cache=shared"  # Shared in-memory database
  max_open_conns: 5
  max_idle_conns: 5
  conn_max_lifetime: 0  # Never close connections in-memory
  conn_max_idle_time: 0
  auto_migrate: true

# Public Server Configuration
server:
  bind_address: "0.0.0.0"  # Listen on all interfaces in container
  bind_port: 8888
  protocol: "https"
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s

# Admin Server Configuration
admin:
  bind_address: "127.0.0.1"  # Admin ONLY accessible inside container
  bind_port: 9090
  protocol: "https"
  read_timeout: 10s
  write_timeout: 10s
  idle_timeout: 60s

# TLS Configuration
tls:
  enabled: true
  cert_file: ""  # Auto-generated self-signed cert
  key_file: ""

# Feature Flags
features:
  health_checks_enabled: true
  metrics_enabled: true
  tracing_enabled: true

# Rate Limiting
rate_limit:
  enabled: false
  requests_per_minute: 100
  burst_size: 20

# CORS Configuration
cors:
  enabled: true
  allowed_origins:
    - "http://localhost:8888"
    - "http://127.0.0.1:8888"
    - "https://localhost:8888"
    - "https://127.0.0.1:8888"
  allowed_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "OPTIONS"
  allowed_headers:
    - "Authorization"
    - "Content-Type"
  allow_credentials: true

# Session Configuration
session:
  browser-session-algorithm: "JWS"
  browser-session-jws-algorithm: "HS256"
  browser-session-jwe-algorithm: "dir+A256GCM"
  service-session-algorithm: "JWS"
  service-session-jws-algorithm: "HS256"
  service-session-jwe-algorithm: "dir+A256GCM"
