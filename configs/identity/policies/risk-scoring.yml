# Risk Scoring Policy Configuration
# Defines risk factor weights, thresholds, and confidence scoring for adaptive authentication
#
# CRITICAL: Changes to this file affect authentication security posture
# Test changes via simulation CLI before deploying to production
# See: docs/02-identityV2/adaptive-auth-runbook.md

version: "1.0"
name: "default-risk-scoring"
description: "Default risk scoring policy for adaptive authentication"

# Risk factor weights (must sum to 1.0 for normalized scoring)
# Higher weight = greater influence on overall risk score
risk_factors:
  location:
    weight: 0.25  # Geographic location anomalies
    description: "Unknown locations, impossible travel, high-risk countries"

  device:
    weight: 0.20  # Device fingerprint anomalies
    description: "Unknown devices, device signature changes"

  time:
    weight: 0.15  # Time-based anomalies
    description: "Unusual login times, rapid authentication attempts"

  behavior:
    weight: 0.20  # User behavior anomalies
    description: "Deviations from baseline behavior patterns"

  network:
    weight: 0.10  # Network-based risk
    description: "VPN usage, proxy detection, Tor exit nodes"

  velocity:
    weight: 0.10  # Velocity anomalies
    description: "Rapid login attempts, account enumeration patterns"

# Risk level thresholds (0.0-1.0 scale)
# Score ranges determine authentication requirements
risk_thresholds:
  low:
    min: 0.0
    max: 0.1
    description: "Trusted context, known device/location, normal behavior"
    auth_requirements:
      - "basic"  # Password only
    max_session_duration: "24h"

  medium:
    min: 0.1
    max: 0.4
    description: "Minor anomalies, new location or device"
    auth_requirements:
      - "basic"
      - "mfa"  # Require MFA (SMS OTP, email OTP, TOTP)
    max_session_duration: "1h"

  high:
    min: 0.4
    max: 0.7
    description: "Significant anomalies, VPN + new device, unusual time"
    auth_requirements:
      - "basic"
      - "strong_mfa"  # Require hardware key or biometric
    max_session_duration: "5m"
    step_up_required: true

  critical:
    min: 0.7
    max: 1.0
    description: "Severe anomalies, velocity attacks, impossible travel"
    auth_requirements:
      - "block"  # Block authentication, require manual review
    max_session_duration: "1m"
    alert_security_team: true

# Confidence scoring weights (how certain we are about the risk assessment)
# Higher confidence = more historical data, more factors available
confidence_weights:
  factor_count: 0.5    # Contribution from number of factors evaluated
  baseline_data: 0.15  # Contribution from user baseline data quality
  behavior_profile: 0.10  # Contribution from behavior profile completeness

# Confidence thresholds for decision-making
confidence_thresholds:
  low: 0.3      # Insufficient data, use conservative defaults
  medium: 0.6   # Adequate data for normal risk assessment
  high: 0.8     # High-quality baseline, confident in assessment

# Network risk scoring
network_risks:
  vpn:
    score: 0.3
    description: "VPN usage increases anonymity risk"

  proxy:
    score: 0.4
    description: "Proxy usage suggests evasion attempt"

  tor:
    score: 0.8
    description: "Tor exit node indicates high anonymity intent"

  known_bad_ip:
    score: 0.9
    description: "IP on threat intelligence blocklist"

# Geographic risk scoring (ISO 3166-1 alpha-2 country codes)
geographic_risks:
  high_risk_countries:
    countries:
      - "KP"  # North Korea
      - "IR"  # Iran
      - "SY"  # Syria
    score: 0.6
    description: "Countries with elevated cybercrime risk"

  embargoed_countries:
    countries:
      - "CU"  # Cuba
      - "SD"  # Sudan
    score: 0.8
    description: "Embargoed countries, blocked by policy"

# Velocity thresholds (rapid authentication attempts)
velocity_limits:
  authentication_attempts:
    window: "15m"
    max_attempts: 5
    risk_score: 0.7
    description: "More than 5 auth attempts in 15 minutes"

  location_changes:
    window: "1h"
    max_locations: 3
    risk_score: 0.8
    description: "Impossible travel (3+ locations in 1 hour)"

  device_changes:
    window: "24h"
    max_devices: 5
    risk_score: 0.6
    description: "Excessive device switching (5+ in 24 hours)"

# Time-based risk (unusual login times relative to user baseline)
time_risks:
  unusual_hour:
    score: 0.2
    description: "Login outside user's normal hours (Â±3 hours from median)"

  unusual_day:
    score: 0.3
    description: "Login on day user rarely authenticates (e.g., weekend for weekday user)"

  after_hours:
    score: 0.4
    description: "Login during organization's after-hours (configurable per tenant)"

# Behavioral anomaly scoring
behavior_risks:
  new_user:
    score: 0.1
    description: "User with <7 days history, limited baseline data"

  inactive_user:
    score: 0.3
    description: "User inactive >30 days, baseline may be stale"

  behavior_change:
    score: 0.5
    description: "Significant deviation from established behavior pattern"
