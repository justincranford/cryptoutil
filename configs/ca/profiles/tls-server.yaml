# TLS Server Certificate Profile
# For web servers, API servers, and other TLS-enabled services.
# Compliant with CA/Browser Forum Baseline Requirements.

profile:
  name: "tls-server"
  description: "TLS Server Authentication Certificate"
  
  # Validity constraints
  validity:
    max_days: 398  # CA/Browser Forum max for public TLS
    min_days: 1
    default_days: 365
  
  # Key constraints
  key:
    allowed_algorithms:
      - algorithm: "RSA"
        min_size: 2048
        max_size: 4096
      - algorithm: "ECDSA"
        allowed_curves:
          - "P-256"
          - "P-384"
          - "P-521"
    default_algorithm: "ECDSA"
    default_curve_or_size: "P-256"
  
  # Key usage (RFC 5280)
  key_usage:
    - "digitalSignature"
    - "keyEncipherment"
  
  # Extended key usage (RFC 5280)
  extended_key_usage:
    required:
      - "serverAuth"  # 1.3.6.1.5.5.7.3.1
    optional:
      - "clientAuth"  # 1.3.6.1.5.5.7.3.2 (for mTLS)
  
  # Subject constraints
  subject:
    require_common_name: true
    allow_organization: true
    allow_organizational_unit: true
    allow_country: true
    allow_state: true
    allow_locality: true
    max_cn_length: 64
  
  # Subject Alternative Name constraints
  san:
    allow_dns_names: true
    allow_ip_addresses: true
    allow_email_addresses: false
    allow_uris: false
    require_at_least_one: true
    max_entries: 100
    # DNS name validation patterns (optional)
    dns_patterns:
      - "*.example.com"
      - "example.com"
    # IP address restrictions (optional)
    allowed_ip_ranges:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
      - "192.168.0.0/16"
      - "127.0.0.0/8"
  
  # Required extensions
  extensions:
    required:
      - "subjectKeyIdentifier"
      - "authorityKeyIdentifier"
      - "keyUsage"
      - "extendedKeyUsage"
      - "basicConstraints"
    optional:
      - "crlDistributionPoints"
      - "authorityInfoAccess"
      - "certificatePolicies"
  
  # Basic constraints (end-entity certificate)
  basic_constraints:
    is_ca: false
    path_length: -1  # Not applicable for end-entity
  
  # Signature algorithm preferences
  signature:
    preferred:
      - "ECDSA-SHA384"
      - "ECDSA-SHA256"
      - "RSA-SHA384"
      - "RSA-SHA256"
    forbidden:
      - "RSA-SHA1"
      - "ECDSA-SHA1"
      - "MD5"
