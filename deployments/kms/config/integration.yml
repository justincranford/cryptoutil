# KMS Integration Configuration
#
# This configuration enables JWT validation using Identity server's JWKS.
# Used in the integration demo to authenticate KMS requests with Identity tokens.
#
# CRITICAL: All settings here extend/override common.yml and sqlite.yml

# CORS configuration for integration demo
cors-origins:
  - "https://localhost:8080"
  - "https://127.0.0.1:8080"
  - "https://localhost:8082"
  - "https://127.0.0.1:8082"

# OTLP identifiers
otlp-service: cryptoutil-kms-integration
otlp-hostname: cryptoutil-kms

# JWT/Token validation configuration
auth:
  # Enable JWT validation for incoming requests
  enabled: true

  # JWKS endpoint from Identity AuthZ server
  jwks-url: "https://identity-authz:8082/.well-known/jwks.json"

  # Cache JWKS for 5 minutes
  jwks-cache-ttl: 5m

  # Required issuer claim
  required-issuer: "https://identity-authz:8082"

  # Required audience claim
  required-audience: "cryptoutil-kms"

  # Allowed signing algorithms
  allowed-algorithms:
    - RS256
    - RS384
    - RS512
    - ES256
    - ES384
    - ES512
    - EdDSA

  # Revocation check configuration
  revocation:
    # Check mode: every-request, sensitive-only, interval, disabled
    mode: sensitive-only

    # Interval for periodic checks (when mode=interval)
    interval: 5m

    # Introspection endpoint for revocation checks
    introspection-url: "https://identity-authz:8082/oauth2/introspect"

    # Scopes that trigger revocation checks in sensitive-only mode
    sensitive-scopes:
      - kms:admin
      - kms:write
      - kms:key:delete
      - kms:pool:delete

  # Error detail level: minimal, standard, verbose
  error-detail-level: standard

# Scope enforcement configuration
scopes:
  # Enable scope enforcement
  enabled: true

  # Default required scope for all operations
  default-scope: kms:read

  # Per-operation scope requirements
  operations:
    # Pool operations
    pool-create: kms:pool:create
    pool-read: kms:pool:read
    pool-update: kms:pool:update
    pool-delete: kms:pool:delete

    # Key operations
    key-create: kms:key:create
    key-read: kms:key:read
    key-rotate: kms:key:rotate
    key-delete: kms:key:delete

    # Crypto operations
    encrypt: kms:encrypt
    decrypt: kms:decrypt
    sign: kms:sign
    verify: kms:verify
    wrap: kms:wrap
    unwrap: kms:unwrap
    generate: kms:generate
    derive: kms:derive

# Development mode - enables in-memory SQLite
dev: true
