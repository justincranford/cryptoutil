# SUITE-level deployment - All 9 services across 5 products
# See: docs/ARCHITECTURE-COMPOSE-MULTIDEPLOY.md Section 4.3
#
# Usage: cd deployments/cryptoutil && docker compose up
#
# This compose file includes all PRODUCT-level compose files to deploy
# the complete cryptoutil suite (all 9 services).
#
# Single-service products (sm, pki, cipher, jose) reference SERVICE-level
# compose directly since PRODUCT == SERVICE for these.
#
# Multi-service products (identity) reference PRODUCT-level compose which
# aggregates all services within that product.

include:
  # Single-service products (PRODUCT == SERVICE)
  - path: ../sm-kms/compose.yml     # sm product (kms service)
  - path: ../pki-ca/compose.yml     # pki product (ca service)
  - path: ../cipher-im/compose.yml  # cipher product (im service)
  - path: ../jose-ja/compose.yml    # jose product (ja service)
  
  # Multi-service products (PRODUCT aggregates multiple SERVICEs)
  - path: ../identity/compose.yml   # identity product (authz, idp, rp, rs, spa services)

# SUITE-level secrets (shared by ALL 9 services)
# See: docs/ARCHITECTURE-COMPOSE-MULTIDEPLOY.md Section 5.2 "Layered Pepper Strategy"
#
# When this SUITE compose file is used, the cryptoutil-hash_pepper.secret
# overrides PRODUCT and SERVICE level hash_pepper secrets via Docker Compose
# merging rules (parent > child).
#
# This enables cross-product SSO and unified identity federation.

secrets:
  cryptoutil-hash_pepper.secret:
    file: ./secrets/cryptoutil-hash_pepper.secret
