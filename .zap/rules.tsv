# ZAP DAST Rules Configuration
# This file defines custom rules for OWASP ZAP security scanning
# Format: WARN/IGNORE/FAIL	RULE_ID	URL_REGEX	PARAMETER	CWE_ID	WASCID	DESCRIPTION

# Ignore false positives for health checks and static content
IGNORE	10021	http://localhost:9090/readyz	.*	.*	.*	Admin health check endpoints - expected behavior
IGNORE	10021	http://localhost:9090/livez	.*	.*	.*	Admin health check endpoints - expected behavior
IGNORE	10021	http://localhost:9090/shutdown	.*	.*	.*	Admin health check endpoints - expected behavior
IGNORE	10021	https://localhost:8080/ui/swagger/.*	.*	.*	.*	Swagger UI static content - expected behavior
IGNORE	10021	https://localhost:8080/service/api/v1/.*	.*	.*	.*	Service API endpoints - machine-to-machine, Spectre headers not applicable
IGNORE	10045	https://localhost:8080/ui/swagger/doc.json	.*	.*	.*	OpenAPI spec disclosure - intentional for API documentation
IGNORE	90004	https://localhost:8080/service/api/v1/.*	.*	.*	.*	Service API endpoints - machine-to-machine, Spectre headers not applicable
IGNORE	90022	https://localhost:8080/ui/swagger/doc.json	.*	.*	.*	OpenAPI error schema disclosure - intentional for API documentation

# Ignore self-signed certificate warnings in development/testing (ZAP rule for SSL/TLS issues)
IGNORE	10054	.*	.*	.*	.*	Self-signed certificates expected in dev/test environments

# Cryptographic endpoint specific rules - Updated for current API structure
WARN	90001	https://localhost:8080/service/api/v1/.*	.*	.*	.*	Monitor cryptographic operations for timing attacks
WARN	90001	https://localhost:8080/browser/api/v1/.*	.*	.*	.*	Monitor cryptographic operations for timing attacks
WARN	90001	https://localhost:8080/service/api/v1/keygen/.*	.*	.*	.*	Key generation endpoints - monitor for timing and entropy issues
WARN	90001	https://localhost:8080/browser/api/v1/keygen/.*	.*	.*	.*	Key generation endpoints - monitor for timing and entropy issues
WARN	90022	https://localhost:8080/.*/csrf-token	.*	.*	.*	CSRF token endpoints - verify proper implementation

# Server security headers - enforce required headers (elevated from IGNORE)
# 10016 X-Content-Type-Options / XSS related legacy header (treat absence as WARN)
WARN	10016	.*	.*	.*	.*	Security header (legacy XSS / content-type protection) missing or misconfigured
# 10017 Cross-domain script include (possible JSONP / insecure include) - warn
WARN	10017	.*	.*	.*	.*	Cross-domain script include potential risk
# 10020 X-Frame-Options missing - should generally FAIL for this app (DENY via Helmet)
FAIL	10020	.*	.*	.*	.*	Missing X-Frame-Options header (should be DENY)
# Additional explicit security header expectations (custom pseudo rule IDs > 91000 for tracking if ZAP doesn't natively cover)
FAIL	91001	.*	.*	.*	.*	Missing Strict-Transport-Security header
FAIL	91002	.*	.*	.*	.*	Missing Content-Security-Policy header
WARN	91003	.*	.*	.*	.*	Missing Referrer-Policy header
WARN	91004	.*	.*	.*	.*	Missing Permissions-Policy header
WARN	91005	.*	.*	.*	.*	Missing Cross-Origin-Opener-Policy header
WARN	91006	.*	.*	.*	.*	Missing Cross-Origin-Embedder-Policy header
WARN	91007	.*	.*	.*	.*	Missing Cross-Origin-Resource-Policy header
WARN	91008	.*	.*	.*	.*	Missing Clear-Site-Data header (expected on logout endpoints only - verify manually)

# Content type and encoding
WARN	10019	.*	.*	.*	.*	Content type incorrectly stated
WARN	10015	.*	.*	.*	.*	Incomplete or no cache-control and pragma HTTP header set

# Database and injection testing - be strict about these
FAIL	40018	.*	.*	.*	.*	SQL Injection
FAIL	40021	.*	.*	.*	.*	SQL Injection (PostgreSQL)
FAIL	40022	.*	.*	.*	.*	SQL Injection (SQLite)
FAIL	90019	.*	.*	.*	.*	Code Injection
FAIL	90020	.*	.*	.*	.*	Command Injection
FAIL	90021	.*	.*	.*	.*	XPATH Injection
FAIL	90023	.*	.*	.*	.*	XML External Entity Attack

# Authentication and session management
FAIL	10010	.*	.*	.*	.*	Cookie not secure
FAIL	10011	.*	.*	.*	.*	Cookie without HttpOnly flag
FAIL	10052	.*	.*	.*	.*	X-ChromeLogger-Data header information leak
FAIL	10054	.*	.*	.*	.*	Cookie without SameSite attribute

# Cryptographic weaknesses
FAIL	90024	.*	.*	.*	.*	Generic Padding Oracle
FAIL	90025	.*	.*	.*	.*	Expression Language Injection
FAIL	90029	.*	.*	.*	.*	LDAP Injection

# Monitor but don't fail on information disclosure (might be expected for API docs)
WARN	10045	.*	.*	.*	.*	Source code disclosure
WARN	10046	.*	.*	.*	.*	Backup file disclosure
WARN	10047	.*	.*	.*	.*	Directory browsing enabled
WARN	10048	.*	.*	.*	.*	Remote file inclusion

# Rate limiting and DoS protection
WARN	90026	.*	.*	.*	.*	Slow HTTP DoS attack
WARN	90027	.*	.*	.*	.*	HTTP parameter pollution

# Proxy disclosure - TRACE method properly rejected (405 Method Not Allowed is correct behavior)
IGNORE	20019	.*	.*	.*	.*	Proxy disclosure via TRACE method - server correctly rejects unsupported methods
